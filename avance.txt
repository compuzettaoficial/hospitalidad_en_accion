# üè† ESTRUCTURA COMPLETA - WEBAPP HOSPITALIDAD CRISTIANA

## üéØ PROP√ìSITO Y VALORES FUNDAMENTALES

**Misi√≥n**: Webapp que conecta cristianos para ofrecer hospitalidad gratuita durante eventos religiosos. Los hermanos sin recursos pueden encontrar hospedaje gratuito en casas de otros cristianos.

**Valores Cristianos Fundamentales**:
- ‚≠ê **LA VALORACI√ìN ES POR COMPORTAMIENTO CRISTIANO, NO POR LUJOS**
- üè† Pueden participar personas humildes con casas humildes
- ‚ù§Ô∏è El trato y semejanza al car√°cter de Cristo es lo que se valora
- üÜì Servicio completamente gratuito
- ü§ù Fomentar la hospitalidad b√≠blica entre hermanos

---

## üèóÔ∏è ESTRUCTURA DE ARCHIVOS ACTUALIZADA

```
/
‚îú‚îÄ‚îÄ index.html                     ‚Üí P√°gina principal (grilla eventos)
‚îú‚îÄ‚îÄ welcome.html                   ‚Üí Presentaci√≥n inicial
‚îú‚îÄ‚îÄ event-detail.html             ‚Üí Detalle de evento
‚îú‚îÄ‚îÄ profile.html                   ‚Üí Mi Perfil (centro de notificaciones)
‚îú‚îÄ‚îÄ auth/
‚îÇ   ‚îú‚îÄ‚îÄ login.html                 ‚Üí Login
‚îÇ   ‚îú‚îÄ‚îÄ register.html              ‚Üí Registro de usuario
‚îÇ   ‚îî‚îÄ‚îÄ forgot-password.html       ‚Üí Recuperar contrase√±a
‚îú‚îÄ‚îÄ admin/
‚îÇ   ‚îú‚îÄ‚îÄ dashboard.html             ‚Üí Panel administrador
‚îÇ   ‚îú‚îÄ‚îÄ events-management.html     ‚Üí Gesti√≥n de eventos
‚îÇ   ‚îú‚îÄ‚îÄ users-management.html      ‚Üí Gesti√≥n de usuarios
‚îÇ   ‚îú‚îÄ‚îÄ editors-assignment.html    ‚Üí Asignaci√≥n editores a eventos
‚îÇ   ‚îú‚îÄ‚îÄ verification-center.html   ‚Üí Centro de verificaci√≥n manual
‚îÇ   ‚îú‚îÄ‚îÄ matching-manual.html       ‚Üí Sistema de emparejamiento manual
‚îÇ   ‚îú‚îÄ‚îÄ ratings-management.html    ‚Üí Gesti√≥n de valoraciones
‚îÇ   ‚îú‚îÄ‚îÄ event-observations.html    ‚Üí Observaciones por evento
‚îÇ   ‚îú‚îÄ‚îÄ backup-management.html     ‚Üí Gesti√≥n de contingencias
‚îÇ   ‚îî‚îÄ‚îÄ reports.html               ‚Üí Reportes y estad√≠sticas
‚îú‚îÄ‚îÄ editor/
‚îÇ   ‚îú‚îÄ‚îÄ dashboard.html             ‚Üí Panel editor (eventos asignados)
‚îÇ   ‚îú‚îÄ‚îÄ my-events.html             ‚Üí Mis eventos asignados
‚îÇ   ‚îú‚îÄ‚îÄ verification-assigned.html ‚Üí Verificaci√≥n eventos asignados
‚îÇ   ‚îú‚îÄ‚îÄ matching-assigned.html     ‚Üí Emparejamiento eventos asignados
‚îÇ   ‚îú‚îÄ‚îÄ observations-assigned.html ‚Üí Observaciones eventos asignados
‚îÇ   ‚îî‚îÄ‚îÄ reports-assigned.html      ‚Üí Reportes de eventos asignados
‚îú‚îÄ‚îÄ event/
‚îÇ   ‚îú‚îÄ‚îÄ create-event.html          ‚Üí Crear evento (admin)
‚îÇ   ‚îú‚îÄ‚îÄ edit-event.html            ‚Üí Editar evento (admin/editor asignado)
‚îÇ   ‚îú‚îÄ‚îÄ hotels-management.html     ‚Üí Gesti√≥n hoteles/cocheras
‚îÇ   ‚îú‚îÄ‚îÄ participants.html          ‚Üí Gesti√≥n participantes
‚îÇ   ‚îú‚îÄ‚îÄ accommodation-info.html    ‚Üí Info de alojamientos para asistentes
‚îÇ   ‚îî‚îÄ‚îÄ contingency-plan.html      ‚Üí Plan de contingencia
‚îú‚îÄ‚îÄ forms/
‚îÇ   ‚îú‚îÄ‚îÄ host-registration.html     ‚Üí Registro anfitri√≥n
‚îÇ   ‚îú‚îÄ‚îÄ visitor-application.html   ‚Üí Postulaci√≥n visitante
‚îÇ   ‚îú‚îÄ‚îÄ attendee-registration.html ‚Üí Registro asistente
‚îÇ   ‚îú‚îÄ‚îÄ verification-form.html     ‚Üí Formulario verificaci√≥n
‚îÇ   ‚îî‚îÄ‚îÄ application-review.html    ‚Üí Revisi√≥n de postulaciones
‚îú‚îÄ‚îÄ ratings/
‚îÇ   ‚îú‚îÄ‚îÄ rate-host.html             ‚Üí Valorar anfitri√≥n (comportamiento cristiano)
‚îÇ   ‚îú‚îÄ‚îÄ rate-visitor.html          ‚Üí Valorar visitante (comportamiento cristiano)
‚îÇ   ‚îú‚îÄ‚îÄ ratings-display.html       ‚Üí Mostrar valoraciones
‚îÇ   ‚îî‚îÄ‚îÄ christian-criteria.html    ‚Üí Criterios de valoraci√≥n cristiana
‚îú‚îÄ‚îÄ verification/
‚îÇ   ‚îú‚îÄ‚îÄ pending-verification.html  ‚Üí Verificaciones pendientes
‚îÇ   ‚îú‚îÄ‚îÄ verification-process.html  ‚Üí Proceso de verificaci√≥n
‚îÇ   ‚îî‚îÄ‚îÄ verification-history.html  ‚Üí Historial de verificaciones
‚îú‚îÄ‚îÄ notifications/
‚îÇ   ‚îú‚îÄ‚îÄ profile-notifications.html ‚Üí Notificaciones en perfil
‚îÇ   ‚îî‚îÄ‚îÄ status-updates.html        ‚Üí Actualizaciones de estado
‚îú‚îÄ‚îÄ css/
‚îÇ   ‚îú‚îÄ‚îÄ main.css                   ‚Üí Estilos principales
‚îÇ   ‚îú‚îÄ‚îÄ admin.css                  ‚Üí Estilos panel admin
‚îÇ   ‚îú‚îÄ‚îÄ editor.css                 ‚Üí Estilos panel editor
‚îÇ   ‚îú‚îÄ‚îÄ forms.css                  ‚Üí Estilos formularios
‚îÇ   ‚îú‚îÄ‚îÄ ratings.css                ‚Üí Estilos sistema valoraci√≥n
‚îÇ   ‚îú‚îÄ‚îÄ verification.css           ‚Üí Estilos verificaci√≥n
‚îÇ   ‚îú‚îÄ‚îÄ notifications.css          ‚Üí Estilos notificaciones
‚îÇ   ‚îî‚îÄ‚îÄ components.css             ‚Üí Estilos componentes
‚îú‚îÄ‚îÄ js/
‚îÇ   ‚îú‚îÄ‚îÄ main.js                    ‚Üí L√≥gica principal
‚îÇ   ‚îú‚îÄ‚îÄ firebase-config.js         ‚Üí Configuraci√≥n Firebase
‚îÇ   ‚îú‚îÄ‚îÄ auth.js                    ‚Üí Autenticaci√≥n
‚îÇ   ‚îú‚îÄ‚îÄ events.js                  ‚Üí Gesti√≥n eventos
‚îÇ   ‚îú‚îÄ‚îÄ users.js                   ‚Üí Gesti√≥n usuarios
‚îÇ   ‚îú‚îÄ‚îÄ permissions.js             ‚Üí Control de permisos por evento
‚îÇ   ‚îú‚îÄ‚îÄ verification.js            ‚Üí Sistema verificaci√≥n manual
‚îÇ   ‚îú‚îÄ‚îÄ matching-manual.js         ‚Üí Sistema emparejamiento manual
‚îÇ   ‚îú‚îÄ‚îÄ ratings-christian.js       ‚Üí Sistema valoraciones cristianas
‚îÇ   ‚îú‚îÄ‚îÄ notifications.js           ‚Üí Sistema notificaciones internas
‚îÇ   ‚îú‚îÄ‚îÄ backup-system.js           ‚Üí Sistema de contingencia
‚îÇ   ‚îú‚îÄ‚îÄ observations.js            ‚Üí Sistema de observaciones
‚îÇ   ‚îî‚îÄ‚îÄ utils.js                   ‚Üí Funciones utilitarias
‚îú‚îÄ‚îÄ img/
‚îÇ   ‚îú‚îÄ‚îÄ logos/
‚îÇ   ‚îú‚îÄ‚îÄ banners/
‚îÇ   ‚îú‚îÄ‚îÄ events/
‚îÇ   ‚îú‚îÄ‚îÄ hotels/
‚îÇ   ‚îú‚îÄ‚îÄ christian-values/
‚îÇ   ‚îî‚îÄ‚îÄ icons/
‚îî‚îÄ‚îÄ components/
    ‚îú‚îÄ‚îÄ header.html
    ‚îú‚îÄ‚îÄ footer.html
    ‚îú‚îÄ‚îÄ event-card.html
    ‚îú‚îÄ‚îÄ star-rating-christian.html
    ‚îú‚îÄ‚îÄ verification-badge.html
    ‚îú‚îÄ‚îÄ notification-center.html
    ‚îî‚îÄ‚îÄ navigation.html
```

---

## üé≠ SISTEMA DE ROLES Y PERMISOS ACTUALIZADO

### üîë ADMINISTRADOR (compuzettaoficial@gmail.com)
- ‚úÖ Acceso total a todos los eventos
- ‚úÖ Asignar editores a eventos espec√≠ficos
- ‚úÖ Crear/eliminar eventos en cualquier ciudad
- ‚úÖ Gestionar usuarios y cambiar roles
- ‚úÖ **Sistema de verificaci√≥n manual completo**
- ‚úÖ **Sistema de emparejamiento manual**
- ‚úÖ **Gesti√≥n de observaciones por evento**
- ‚úÖ **Sistema de backup y contingencias**
- ‚úÖ Acceso completo al sistema de valoraciones cristianas
- ‚úÖ Ver reportes globales de toda la plataforma

### ‚úèÔ∏è EDITOR
- ‚úÖ Acceso limitado solo a eventos asignados por el admin
- ‚úÖ Verificaci√≥n manual solo de sus eventos asignados
- ‚úÖ Emparejamiento manual solo en sus eventos asignados
- ‚úÖ Editar informaci√≥n solo de sus eventos asignados
- ‚úÖ Gestionar hoteles/cocheras solo de sus eventos
- ‚úÖ Crear observaciones solo de sus eventos asignados
- ‚úÖ Ver reportes solo de sus eventos
- ‚ùå No puede crear eventos nuevos
- ‚ùå No puede acceder a eventos no asignados

### üë§ USUARIO
- ‚úÖ Acceso b√°sico a funcionalidades
- ‚úÖ Participar en cualquier evento
- ‚úÖ Ver informaci√≥n de todos los eventos
- ‚úÖ **Centro de notificaciones en Mi Perfil**
- ‚úÖ **Sistema de valoraci√≥n bidireccional**
- ‚úÖ **Proceso de verificaci√≥n personal**

---

## üìä ESTRUCTURA DE BASE DE DATOS ACTUALIZADA

### üóÇÔ∏è Colecci√≥n: usuarios (ACTUALIZADA)
```javascript
{
  uid: "user_id",
  nombre: "string",
  apellido: "string",
  email: "string",
  rol: "administrador|editor|usuario",
  telefono: "string",
  estado: "activo|inactivo",
  
  // SISTEMA DE VERIFICACI√ìN MANUAL
  verificacion: {
    estado: "pendiente_verificacion|verificado|rechazado",
    fecha_solicitud: "timestamp",
    fecha_verificacion: "timestamp",
    verificado_por: "admin_user_id",
    notas_verificador: "string",
    metodo_verificacion: "whatsapp|llamada|presencial",
    contacto_verificacion: "string",
    documentos_verificados: ["cedula", "referencias", "etc"]
  },
  
  // SISTEMA DE VALORACI√ìN CRISTIANA
  valoracion: {
    base_registro: 1, // +1 estrella por registrarse
    base_verificacion: 1, // +1 estrella por verificaci√≥n
    valoraciones_recibidas: [{
      evento_id: "string",
      valorador_id: "string",
      puntos: "number (1-5)",
      comentario: "string",
      criterios_cristianos: {
        amabilidad: "number (1-5)",
        hospitalidad: "number (1-5)", 
        respeto: "number (1-5)",
        caracter_cristiano: "number (1-5)",
        servicio_desinteresado: "number (1-5)"
      },
      fecha_valoracion: "timestamp"
    }],
    promedio_total: "number",
    total_valoraciones: "number"
  },
  
  // NOTIFICACIONES INTERNAS (SIN COSTO)
  notificaciones_internas: {
    verificacion_estado: "pendiente|completada|rechazada",
    postulaciones: [{
      evento_id: "string",
      tipo: "hospedador|visitante",
      estado: "postulado|verificado|asignado|rechazado",
      fecha_postulacion: "timestamp",
      fecha_actualizacion: "timestamp"
    }],
    asignaciones_actuales: [{
      evento_id: "string",
      tipo: "hospedador|visitante",
      asignado_con: "user_id",
      fecha_asignacion: "timestamp"
    }],
    mensajes_admin: [{
      mensaje: "string",
      fecha: "timestamp",
      leido: "boolean"
    }]
  },
  
  // SISTEMA DE EDITORES
  eventos_asignados: ["evento_id1", "evento_id2"], // Solo para editores
  asignado_por: "admin_user_id",
  fecha_asignacion: "timestamp",
  createdAt: "timestamp"
}
```

### üóÇÔ∏è Colecci√≥n: eventos (ACTUALIZADA)
```javascript
{
  id: "evento_id",
  titulo: "string",
  descripcion: "string",
  lugar: "string",
  ciudad: "string",
  direccion_completa: "string", // Ubicaci√≥n manual
  coordenadas_gps: "string", // Opcional, llenado manual
  fecha_inicio: "timestamp",
  fecha_fin: "timestamp",
  imagenURL: "string",
  estado: "activo|inactivo",
  creado_por: "user_id",
  
  // SISTEMA DE EDITORES
  editores_asignados: ["editor_id1", "editor_id2"],
  region: "string",
  
  // ESTAD√çSTICAS
  estadisticas: {
    anfitriones: "number",
    visitantes: "number",
    asistentes: "number",
    emparejamientos: "number",
    verificaciones_completadas: "number"
  },
  
  // ALOJAMIENTOS CERCANOS (MANUAL)
  hoteles: [{
    nombre: "string",
    direccion: "string",
    telefono: "string",
    precio_aproximado: "string",
    distancia_evento: "string", // Escrito manualmente
    notas: "string"
  }],
  
  cocheras: [{
    nombre: "string",
    direccion: "string",
    telefono: "string",
    precio_por_dia: "string",
    capacidad: "number",
    distancia_evento: "string",
    notas: "string"
  }],
  
  // SISTEMA DE CONTINGENCIA
  contingencia: {
    anfitriones_backup: ["user_id1", "user_id2"],
    contactos_emergencia: [{
      nombre: "string",
      telefono: "string",
      relacion: "string",
      disponibilidad: "string"
    }],
    protocolo_cancelacion: "string",
    hoteles_emergencia: ["hotel_id1", "hotel_id2"]
  }
}
```

### üóÇÔ∏è Colecci√≥n: postulaciones (ACTUALIZADA)
```javascript
{
  id: "postulacion_id",
  evento_id: "string",
  usuario_id: "string",
  tipo: "hospedador|visitante",
  
  // ESTADOS DETALLADOS
  estado: "postulado|verificado|asignado|rechazado",
  fecha_postulacion: "timestamp",
  fecha_verificacion: "timestamp",
  fecha_asignacion: "timestamp",
  
  // VERIFICACI√ìN MANUAL
  verificacion_admin: {
    verificado_por: "admin_user_id",
    fecha_verificacion: "timestamp",
    metodo_verificacion: "whatsapp|llamada|presencial",
    notas_verificacion: "string",
    documentos_revisados: ["string"],
    aprobado: "boolean"
  },
  
  // DATOS HOSPEDADOR
  datos_hospedador: {
    numero_habitaciones: "number",
    numero_camas: "number",
    personas_puede_hospedar: "number",
    tiene_cochera: "boolean",
    servicios_adicionales: ["desayuno", "transporte", "etc"],
    reglas_casa: "string",
    ubicacion_detalle: "string"
  },
  
  // DATOS VISITANTE
  datos_visitante: {
    numero_personas: "number",
    habitaciones_solicitadas: "number",
    tiene_vehiculo: "boolean",
    necesidades_especiales: "string",
    preferencias: "string",
    referencias: "string"
  },
  
  // ASIGNACI√ìN MANUAL
  asignacion: {
    asignado_con: "user_id",
    asignado_por: "admin_user_id",
    fecha_asignacion: "timestamp",
    notas_asignacion: "string",
    es_asignacion_backup: "boolean"
  }
}
```

### üóÇÔ∏è Colecci√≥n: emparejamientos (NUEVA)
```javascript
{
  id: "emparejamiento_id",
  evento_id: "string",
  anfitrion_id: "string",
  visitante_id: "string",
  
  // PROCESO MANUAL
  sugerido_por_algoritmo: "boolean",
  confirmado_por_admin: "admin_user_id",
  fecha_sugerencia: "timestamp",
  fecha_confirmacion: "timestamp",
  estado: "sugerido|confirmado|cancelado",
  
  // COMPATIBILIDAD
  compatibilidad_score: "number", // Para vista previa
  criterios_compatibilidad: {
    ubicacion: "number",
    capacidad: "number",
    vehiculo: "boolean",
    necesidades_especiales: "boolean"
  },
  
  // INFORMACI√ìN DEL EMPAREJAMIENTO
  detalles: {
    habitaciones_asignadas: "number",
    camas_asignadas: "number",
    cochera_asignada: "boolean",
    servicios_incluidos: ["string"],
    reglas_especiales: "string"
  },
  
  // BACKUP
  es_asignacion_backup: "boolean",
  emparejamiento_original: "emparejamiento_id"
}
```

### üóÇÔ∏è Colecci√≥n: valoraciones_cristianas (NUEVA)
```javascript
{
  id: "valoracion_id",
  evento_id: "string",
  valorador_id: "string",
  valorado_id: "string",
  tipo_relacion: "anfitrion_a_visitante|visitante_a_anfitrion",
  
  // CRITERIOS CRISTIANOS ESPEC√çFICOS
  criterios: {
    amabilidad: "number (1-5)",
    hospitalidad: "number (1-5)",
    respeto: "number (1-5)",
    caracter_cristiano: "number (1-5)",
    servicio_desinteresado: "number (1-5)",
    paciencia: "number (1-5)",
    generosidad: "number (1-5)"
  },
  
  // COMENTARIOS
  comentario_positivo: "string",
  areas_mejora: "string", // Constructivo, en amor cristiano
  recomendaria: "boolean",
  
  // ACLARACI√ìN IMPORTANTE
  aclaracion: "Esta valoraci√≥n se basa en el comportamiento cristiano y el trato recibido, NO en la calidad material del alojamiento o lujos ofrecidos",
  
  fecha_valoracion: "timestamp",
  verificado_por_admin: "boolean"
}
```

### üóÇÔ∏è Colecci√≥n: observaciones_eventos (NUEVA)
```javascript
{
  id: "observacion_id",
  evento_id: "string",
  admin_id: "string",
  fecha: "timestamp",
  
  // TIPOS DE OBSERVACI√ìN
  tipo: "incidente|mejora|observacion_general|problema_tecnico|sugerencia",
  gravedad: "baja|media|alta|critica",
  
  // CONTENIDO
  titulo: "string",
  descripcion: "string",
  usuarios_involucrados: ["user_id"],
  
  // SEGUIMIENTO
  estado: "abierto|en_revision|resuelto|cerrado",
  acciones_tomadas: "string",
  responsable_seguimiento: "admin_user_id",
  fecha_resolucion: "timestamp",
  
  // MEJORAS PARA LA APP
  impacto_futuro: "string",
  cambios_sugeridos: "string"
}
```

### üóÇÔ∏è Colecci√≥n: verificaciones_manuales (NUEVA)
```javascript
{
  id: "verificacion_id",
  usuario_id: "string",
  admin_verificador: "string",
  fecha_inicio: "timestamp",
  fecha_completada: "timestamp",
  
  // PROCESO DE VERIFICACI√ìN
  metodo: "whatsapp|llamada|presencial|combinado",
  contacto_usado: "string",
  documentos_solicitados: ["cedula", "referencias", "carta_pastor"],
  documentos_recibidos: ["string"],
  
  // VERIFICACI√ìN DETALLADA
  verificaciones: {
    identidad: "boolean",
    telefono: "boolean",
    direccion: "boolean",
    referencias_cristianas: "boolean",
    antecedentes: "boolean"
  },
  
  // RESULTADO
  resultado: "aprobado|rechazado|pendiente_documentos",
  notas_verificador: "string",
  observaciones: "string",
  
  // SEGUIMIENTO
  requiere_seguimiento: "boolean",
  fecha_siguiente_revision: "timestamp"
}
```

---

## üîÑ FLUJOS DE TRABAJO ACTUALIZADOS

### 1. üìã FLUJO DE VERIFICACI√ìN MANUAL
```
Usuario se registra ‚Üí Estado: "pendiente_verificacion"
     ‚Üì
Admin/Editor revisa solicitud ‚Üí Contacta por WhatsApp/llamada
     ‚Üì
Verificaci√≥n exitosa ‚Üí Estado: "verificado" + 1 estrella
     ‚Üì
Usuario habilitado para postular a eventos
```

### 2. ü§ù FLUJO DE EMPAREJAMIENTO MANUAL
```
M√∫ltiples usuarios postulan (anfitriones + visitantes)
     ‚Üì
Algoritmo genera vista previa con compatibilidad
     ‚Üì
Admin revisa sugerencias ‚Üí Decide manualmente
     ‚Üì
Admin confirma emparejamiento ‚Üí Notifica a usuarios
     ‚Üì
Sistema actualiza estados ‚Üí Visible en "Mi Perfil"
```

### 3. üîÑ FLUJO DE CONTINGENCIA
```
Anfitri√≥n cancela ‚Üí Sistema detecta
     ‚Üì
Admin busca en lista de backup
     ‚Üì
Reasigna visitante ‚Üí Notifica cambio
     ‚Üì
Si no hay backup ‚Üí Deriva a hoteles de emergencia
```

### 4. ‚≠ê FLUJO DE VALORACI√ìN CRISTIANA
```
Evento termina ‚Üí Habilita valoraci√≥n mutua
     ‚Üì
Anfitri√≥n valora visitante + Visitante valora anfitri√≥n
     ‚Üì
Sistema calcula promedio ‚Üí Actualiza perfil
     ‚Üì
Admin revisa valoraciones ‚Üí Modera si es necesario
```

---

## üõ°Ô∏è SISTEMA DE SEGURIDAD ACTUALIZADO

### 1. üîê Middleware de Verificaci√≥n
```javascript
// Verificar estado de verificaci√≥n antes de postular
function checkVerificationStatus(req, res, next) {
  const userId = req.user.uid;
  
  getUserVerificationStatus(userId)
    .then(status => {
      if (status === 'verificado') {
        next();
      } else {
        res.status(403).json({ 
          error: 'Debe completar la verificaci√≥n antes de postular',
          redirect: '/verification/verification-process.html'
        });
      }
    });
}
```

### 2. üîí Control de Emparejamiento Manual
```javascript
// Solo admin puede confirmar emparejamientos
function checkMatchingPermission(req, res, next) {
  const userId = req.user.uid;
  const eventoId = req.params.eventoId;
  
  if (req.user.rol === 'administrador') {
    next();
  } else if (req.user.rol === 'editor') {
    // Verificar si el editor tiene este evento asignado
    verificarEventoAsignado(userId, eventoId)
      .then(hasPermission => {
        if (hasPermission) {
          next();
        } else {
          res.status(403).json({ error: 'No tienes permisos para este evento' });
        }
      });
  } else {
    res.status(403).json({ error: 'Solo admin/editor pueden confirmar emparejamientos' });
  }
}
```

### 3. üîç Reglas de Firestore Actualizadas
```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // Valoraciones: solo participantes del evento pueden valorar
    match /valoraciones_cristianas/{valoracionId} {
      allow create: if request.auth != null && 
        exists(/databases/$(database)/documents/emparejamientos/$(getEmparejamientoId())) &&
        (request.resource.data.valorador_id == request.auth.uid);
      
      allow read: if request.auth != null;
      allow update: if false; // No se pueden modificar valoraciones
      allow delete: if false; // No se pueden eliminar valoraciones
    }
    
    // Observaciones: solo admin/editor asignado
    match /observaciones_eventos/{observacionId} {
      allow create, update: if request.auth != null && 
        (get(/databases/$(database)/documents/usuarios/$(request.auth.uid)).data.rol == 'administrador' ||
         (get(/databases/$(database)/documents/usuarios/$(request.auth.uid)).data.rol == 'editor' &&
          request.resource.data.evento_id in get(/databases/$(database)/documents/usuarios/$(request.auth.uid)).data.eventos_asignados));
    }
    
    // Verificaciones: solo admin/editor
    match /verificaciones_manuales/{verificacionId} {
      allow create, update: if request.auth != null && 
        (get(/databases/$(database)/documents/usuarios/$(request.auth.uid)).data.rol in ['administrador', 'editor']);
      
      allow read: if request.auth != null && 
        (request.auth.uid == resource.data.usuario_id || 
         get(/databases/$(database)/documents/usuarios/$(request.auth.uid)).data.rol in ['administrador', 'editor']);
    }
  }
}
```

---

## üé® INTERFACES ACTUALIZADAS

### 1. üë§ Mi Perfil - Centro de Notificaciones
```html
<!-- profile.html -->
<div class="profile-notifications">
  <h2>Mi Centro de Notificaciones</h2>
  
  <!-- Estado de Verificaci√≥n -->
  <div class="verification-status">
    <h3>Estado de Verificaci√≥n</h3>
    <div class="status-badge" id="verificationBadge">
      <!-- Pendiente/Verificado/Rechazado -->
    </div>
  </div>
  
  <!-- Mis Postulaciones -->
  <div class="my-applications">
    <h3>Mis Postulaciones</h3>
    <div class="applications-list">
      <!-- Lista de postulaciones por evento -->
    </div>
  </div>
  
  <!-- Mis Asignaciones -->
  <div class="my-assignments">
    <h3>Mis Asignaciones Actuales</h3>
    <div class="assignments-list">
      <!-- Lista de asignaciones activas -->
    </div>
  </div>
  
  <!-- Mi Valoraci√≥n -->
  <div class="my-rating">
    <h3>Mi Valoraci√≥n Cristiana</h3>
    <div class="rating-display">
      <div class="stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
      <p>Basada en comportamiento cristiano</p>
    </div>
  </div>
  
  <!-- Mensajes del Admin -->
  <div class="admin-messages">
    <h3>Mensajes Administrativos</h3>
    <div class="messages-list">
      <!-- Mensajes internos -->
    </div>
  </div>
</div>
```

### 2. üîç Panel de Verificaci√≥n Manual
```html
<!-- verification-center.html -->
<div class="verification-center">
  <h2>Centro de Verificaci√≥n Manual</h2>
  
  <!-- Pendientes de Verificaci√≥n -->
  <div class="pending-verifications">
    <h3>Verificaciones Pendientes</h3>
    <div class="verification-queue">
      <div class="verification-item">
        <div class="user-info">
          <img src="avatar.jpg" alt="Usuario">
          <div>
            <h4>Juan P√©rez</h4>
            <p>üìû +51 999 888 777</p>
            <p>üìß juan@email.com</p>
          </div>
        </div>
        <div class="verification-actions">
          <button onclick="iniciarVerificacion('user123')">
            üìû Verificar por WhatsApp
          </button>
          <button onclick="iniciarVerificacion('user123', 'call')">
            ‚òéÔ∏è Verificar por Llamada
          </button>
          <button onclick="rechazarVerificacion('user123')">
            ‚ùå Rechazar
          </button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Formulario de Verificaci√≥n -->
  <div class="verification-form" id="verificationForm" style="display:none;">
    <h3>Proceso de Verificaci√≥n</h3>
    <form>
      <input type="hidden" id="userId" value="">
      
      <div class="form-group">
        <label>M√©todo de Verificaci√≥n:</label>
        <select id="verificationMethod">
          <option value="whatsapp">WhatsApp</option>
          <option value="llamada">Llamada telef√≥nica</option>
          <option value="presencial">Presencial</option>
        </select>
      </div>
      
      <div class="verification-checklist">
        <h4>Verificaciones Realizadas:</h4>
        <label><input type="checkbox" name="identidad"> Identidad verificada</label>
        <label><input type="checkbox" name="telefono"> Tel√©fono verificado</label>
        <label><input type="checkbox" name="direccion"> Direcci√≥n verificada</label>
        <label><input type="checkbox" name="referencias"> Referencias cristianas</label>
        <label><input type="checkbox" name="antecedentes"> Antecedentes verificados</label>
      </div>
      
      <div class="form-group">
        <label>Notas del Verificador:</label>
        <textarea id="verificationNotes" placeholder="Observaciones del proceso de verificaci√≥n..."></textarea>
      </div>
      
      <div class="form-actions">
        <button type="button" onclick="aprobarVerificacion()">
          ‚úÖ Aprobar Verificaci√≥n
        </button>
        <button type="button" onclick="rechazarVerificacion()">
          ‚ùå Rechazar Verificaci√≥n
        </button>
      </div>
    </form>
  </div>
</div>
```

### 3. ü§ù Sistema de Emparejamiento Manual
```html
<!-- matching-manual.html -->
<div class="manual-matching">
  <h2>Sistema de Emparejamiento Manual</h2>
  
  <!-- Selecci√≥n de Evento -->
  <div class="event-selector">
    <label>Seleccionar Evento:</label>
    <select id="eventSelect" onchange="loadEventParticipants()">
      <option value="">Seleccionar evento...</option>
    </select>
  </div>
  
  <!-- Vista Previa de Compatibilidad -->
  <div class="compatibility-preview">
    <h3>Sugerencias de Emparejamiento</h3>
    <div class="suggestions-list" id="suggestionsList">
      <!-- Sugerencias autom√°ticas -->
    </div>
  </div>
  
  <!-- Emparejamiento Manual -->
  <div class="manual-pairing">
    <div class="hosts-column">
      <h3>Anfitriones Disponibles</h3>
      <div class="hosts-list" id="hostsList">
        <!-- Lista de anfitriones -->
      </div>
    </div>
    
    <div class="visitors-column">
      <h3>Visitantes Esperando</h3>
      <div class="visitors-list" id="visitorsList">
        <!-- Lista de visitantes -->
      </div>
    </div>
  </div>
  
  <!-- Confirmaci√≥n de Emparejamiento -->
<div class="pairing-confirmation">
  <h3>Confirmar Emparejamiento</h3>
  <div class="pairing-details">
    <div class="host-details">
      <h4>Anfitri√≥n Seleccionado:</h4>
      <div class="host-info" id="selectedHost">
        <img src="avatar.jpg" alt="Anfitri√≥n">
        <div>
          <h5>Mar√≠a Gonz√°lez</h5>
          <p>‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (4.8/5.0)</p>
          <p>üè† Puede hospedar: 4 personas</p>
          <p>üõèÔ∏è Habitaciones: 2</p>
          <p>üöó Cochera: Disponible</p>
          <p>üìç Av. Principal 123, Miraflores</p>
        </div>
      </div>
    </div>
    
    <div class="visitor-details">
      <h4>Visitante Seleccionado:</h4>
      <div class="visitor-info" id="selectedVisitor">
        <img src="avatar.jpg" alt="Visitante">
        <div>
          <h5>Carlos Rodr√≠guez</h5>
          <p>‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (4.6/5.0)</p>
          <p>üë• Personas: 3</p>
          <p>üõèÔ∏è Habitaciones solicitadas: 1</p>
          <p>üöó Veh√≠culo: S√≠</p>
          <p>üìù Verificado: ‚úÖ</p>
        </div>
      </div>
    </div>
  </div>
  
  <div class="compatibility-score">
    <h4>Puntuaci√≥n de Compatibilidad: <span id="compatibilityScore">92%</span></h4>
    <div class="compatibility-factors">
      <div class="factor">
        <span>Capacidad:</span>
        <div class="progress-bar">
          <div class="progress" style="width: 100%"></div>
        </div>
        <span>100%</span>
      </div>
      <div class="factor">
        <span>Ubicaci√≥n:</span>
        <div class="progress-bar">
          <div class="progress" style="width: 90%"></div>
        </div>
        <span>90%</span>
      </div>
      <div class="factor">
        <span>Veh√≠culo:</span>
        <div class="progress-bar">
          <div class="progress" style="width: 100%"></div>
        </div>
        <span>100%</span>
      </div>
    </div>
  </div>
  
  <div class="pairing-notes">
    <label>Notas del Emparejamiento:</label>
    <textarea id="pairingNotes" placeholder="Observaciones especiales sobre este emparejamiento..."></textarea>
  </div>
  
  <div class="pairing-actions">
    <button onclick="confirmarEmparejamiento()">
      ‚úÖ Confirmar Emparejamiento
    </button>
    <button onclick="buscarAlternativas()">
      üîç Buscar Alternativas
    </button>
    <button onclick="cancelarEmparejamiento()">
      ‚ùå Cancelar
    </button>
  </div>
</div>
```

### 4. ‚≠ê Sistema de Valoraci√≥n Cristiana
```html
<!-- rate-host.html -->
<div class="christian-rating">
  <h2>Valoraci√≥n Cristiana - Anfitri√≥n</h2>
  
  <div class="rating-notice">
    <h3>üìñ Recordatorio Importante</h3>
    <p>Esta valoraci√≥n se basa en el <strong>comportamiento cristiano</strong> y el trato recibido, 
    <strong>NO</strong> en la calidad material del alojamiento o lujos ofrecidos.</p>
    <p>Valoramos el <strong>car√°cter de Cristo</strong> reflejado en nuestros hermanos.</p>
  </div>
  
  <div class="host-info">
    <img src="avatar.jpg" alt="Anfitri√≥n">
    <div>
      <h3>Mar√≠a Gonz√°lez</h3>
      <p>üìç Evento: Convenci√≥n Lima 2025</p>
      <p>üìÖ Fecha: 15-17 Marzo 2025</p>
    </div>
  </div>
  
  <div class="christian-criteria">
    <h3>Criterios de Valoraci√≥n Cristiana</h3>
    
    <div class="criteria-item">
      <label>Amabilidad y Gentileza:</label>
      <div class="star-rating">
        <span onclick="rate('amabilidad', 1)">‚≠ê</span>
        <span onclick="rate('amabilidad', 2)">‚≠ê</span>
        <span onclick="rate('amabilidad', 3)">‚≠ê</span>
        <span onclick="rate('amabilidad', 4)">‚≠ê</span>
        <span onclick="rate('amabilidad', 5)">‚≠ê</span>
      </div>
      <p class="criteria-description">¬øFue amable y gentil en su trato?</p>
    </div>
    
    <div class="criteria-item">
      <label>Hospitalidad Cristiana:</label>
      <div class="star-rating">
        <span onclick="rate('hospitalidad', 1)">‚≠ê</span>
        <span onclick="rate('hospitalidad', 2)">‚≠ê</span>
        <span onclick="rate('hospitalidad', 3)">‚≠ê</span>
        <span onclick="rate('hospitalidad', 4)">‚≠ê</span>
        <span onclick="rate('hospitalidad', 5)">‚≠ê</span>
      </div>
      <p class="criteria-description">¬øDemostr√≥ hospitalidad siguiendo el ejemplo b√≠blico?</p>
    </div>
    
    <div class="criteria-item">
      <label>Respeto y Consideraci√≥n:</label>
      <div class="star-rating">
        <span onclick="rate('respeto', 1)">‚≠ê</span>
        <span onclick="rate('respeto', 2)">‚≠ê</span>
        <span onclick="rate('respeto', 3)">‚≠ê</span>
        <span onclick="rate('respeto', 4)">‚≠ê</span>
        <span onclick="rate('respeto', 5)">‚≠ê</span>
      </div>
      <p class="criteria-description">¬øFue respetuoso con sus necesidades y privacidad?</p>
    </div>
    
    <div class="criteria-item">
      <label>Car√°cter Cristiano:</label>
      <div class="star-rating">
        <span onclick="rate('caracter_cristiano', 1)">‚≠ê</span>
        <span onclick="rate('caracter_cristiano', 2)">‚≠ê</span>
        <span onclick="rate('caracter_cristiano', 3)">‚≠ê</span>
        <span onclick="rate('caracter_cristiano', 4)">‚≠ê</span>
        <span onclick="rate('caracter_cristiano', 5)">‚≠ê</span>
      </div>
      <p class="criteria-description">¬øSu comportamiento reflej√≥ el car√°cter de Cristo?</p>
    </div>
    
    <div class="criteria-item">
      <label>Servicio Desinteresado:</label>
      <div class="star-rating">
        <span onclick="rate('servicio_desinteresado', 1)">‚≠ê</span>
        <span onclick="rate('servicio_desinteresado', 2)">‚≠ê</span>
        <span onclick="rate('servicio_desinteresado', 3)">‚≠ê</span>
        <span onclick="rate('servicio_desinteresado', 4)">‚≠ê</span>
        <span onclick="rate('servicio_desinteresado', 5)">‚≠ê</span>
      </div>
      <p class="criteria-description">¬øSirvi√≥ con un coraz√≥n desinteresado?</p>
    </div>
    
    <div class="criteria-item">
      <label>Paciencia y Comprensi√≥n:</label>
      <div class="star-rating">
        <span onclick="rate('paciencia', 1)">‚≠ê</span>
        <span onclick="rate('paciencia', 2)">‚≠ê</span>
        <span onclick="rate('paciencia', 3)">‚≠ê</span>
        <span onclick="rate('paciencia', 4)">‚≠ê</span>
        <span onclick="rate('paciencia', 5)">‚≠ê</span>
      </div>
      <p class="criteria-description">¬øMostr√≥ paciencia ante cualquier inconveniente?</p>
    </div>
    
    <div class="criteria-item">
      <label>Generosidad de Coraz√≥n:</label>
      <div class="star-rating">
        <span onclick="rate('generosidad', 1)">‚≠ê</span>
        <span onclick="rate('generosidad', 2)">‚≠ê</span>
        <span onclick="rate('generosidad', 3)">‚≠ê</span>
        <span onclick="rate('generosidad', 4)">‚≠ê</span>
        <span onclick="rate('generosidad', 5)">‚≠ê</span>
      </div>
      <p class="criteria-description">¬øFue generoso m√°s all√° de lo necesario?</p>
    </div>
  </div>
  
  <div class="rating-comments">
    <h3>Comentarios</h3>
    <div class="comment-section">
      <label>Aspectos Positivos:</label>
      <textarea id="comentario_positivo" placeholder="Comparte lo que m√°s valoraste de tu hermano/a en Cristo..."></textarea>
    </div>
    
    <div class="comment-section">
      <label>√Åreas de Crecimiento (Opcional):</label>
      <textarea id="areas_mejora" placeholder="Si hay algo que podr√≠a mejorar, comp√°rtelo con amor cristiano..."></textarea>
    </div>
  </div>
  
  <div class="recommendation">
    <label>¬øRecomendar√≠as este anfitri√≥n a otros hermanos?</label>
    <div class="recommendation-options">
      <label><input type="radio" name="recomendaria" value="true"> S√≠, definitivamente</label>
      <label><input type="radio" name="recomendaria" value="false"> No recomendar√≠a</label>
    </div>
  </div>
  
  <div class="rating-actions">
    <button onclick="enviarValoracion()">
      ‚úÖ Enviar Valoraci√≥n
    </button>
    <button onclick="cancelarValoracion()">
      ‚ùå Cancelar
    </button>
  </div>
</div>
```

### 5. üóÇÔ∏è Sistema de Observaciones por Evento
```html
<!-- event-observations.html -->
<div class="event-observations">
  <h2>Observaciones por Evento</h2>
  
  <!-- Selector de Evento -->
  <div class="event-selector">
    <label>Seleccionar Evento:</label>
    <select id="eventSelect" onchange="loadEventObservations()">
      <option value="">Seleccionar evento...</option>
    </select>
  </div>
  
  <!-- Nueva Observaci√≥n -->
  <div class="new-observation">
    <h3>Nueva Observaci√≥n</h3>
    <form id="observationForm">
      <div class="form-row">
        <div class="form-group">
          <label>Tipo de Observaci√≥n:</label>
          <select id="observationType">
            <option value="incidente">Incidente</option>
            <option value="mejora">Mejora</option>
            <option value="observacion_general">Observaci√≥n General</option>
            <option value="problema_tecnico">Problema T√©cnico</option>
            <option value="sugerencia">Sugerencia</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>Gravedad:</label>
          <select id="severity">
            <option value="baja">Baja</option>
            <option value="media">Media</option>
            <option value="alta">Alta</option>
            <option value="critica">Cr√≠tica</option>
          </select>
        </div>
      </div>
      
      <div class="form-group">
        <label>T√≠tulo:</label>
        <input type="text" id="observationTitle" placeholder="T√≠tulo breve de la observaci√≥n...">
      </div>
      
      <div class="form-group">
        <label>Descripci√≥n Detallada:</label>
        <textarea id="observationDescription" placeholder="Describe la observaci√≥n, problema o sugerencia..."></textarea>
      </div>
      
      <div class="form-group">
        <label>Usuarios Involucrados (Opcional):</label>
        <input type="text" id="usersInvolved" placeholder="Buscar usuarios involucrados...">
        <div class="selected-users" id="selectedUsers"></div>
      </div>
      
      <div class="form-group">
        <label>Acciones Tomadas:</label>
        <textarea id="actionsTaken" placeholder="¬øQu√© acciones se tomaron inmediatamente?"></textarea>
      </div>
      
      <div class="form-group">
        <label>Impacto para Futuras Mejoras:</label>
        <textarea id="futureImpact" placeholder="¬øC√≥mo puede esto mejorar la app o los procesos?"></textarea>
      </div>
      
      <div class="form-actions">
        <button type="button" onclick="guardarObservacion()">
          üíæ Guardar Observaci√≥n
        </button>
        <button type="button" onclick="limpiarFormulario()">
          üóëÔ∏è Limpiar Formulario
        </button>
      </div>
    </form>
  </div>
  
  <!-- Lista de Observaciones -->
  <div class="observations-list">
    <h3>Observaciones del Evento</h3>
    <div class="observations-container" id="observationsContainer">
      <!-- Observaciones din√°micas -->
    </div>
  </div>
</div>
```

### 6. üÜò Sistema de Backup y Contingencia
```html
<!-- backup-management.html -->
<div class="backup-management">
  <h2>Sistema de Backup y Contingencia</h2>
  
  <!-- Selector de Evento -->
  <div class="event-selector">
    <label>Seleccionar Evento:</label>
    <select id="eventSelect" onchange="loadEventBackup()">
      <option value="">Seleccionar evento...</option>
    </select>
  </div>
  
  <!-- Anfitriones de Backup -->
  <div class="backup-hosts">
    <h3>Anfitriones de Backup</h3>
    <div class="backup-list">
      <div class="backup-item">
        <div class="host-info">
          <img src="avatar.jpg" alt="Anfitri√≥n">
          <div>
            <h4>Pedro Mart√≠nez</h4>
            <p>‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (4.9/5.0)</p>
            <p>üè† Capacidad: 6 personas</p>
            <p>üìû +51 999 777 888</p>
          </div>
        </div>
        <div class="backup-status">
          <span class="status-badge disponible">Disponible</span>
          <button onclick="contactarBackup('user123')">
            üìû Contactar
          </button>
        </div>
      </div>
    </div>
    
    <div class="add-backup">
      <button onclick="agregarBackup()">
        ‚ûï Agregar Anfitri√≥n de Backup
      </button>
    </div>
  </div>
  
  <!-- Contactos de Emergencia -->
  <div class="emergency-contacts">
    <h3>Contactos de Emergencia</h3>
    <div class="contacts-list">
      <div class="contact-item">
        <div class="contact-info">
          <h4>Pastor Juan Carlos</h4>
          <p>üìû +51 999 111 222</p>
          <p>üè¢ Iglesia Central Lima</p>
          <p>‚è∞ Disponible: 24/7</p>
        </div>
        <div class="contact-actions">
          <button onclick="llamarEmergencia('contact1')">
            üìû Llamar
          </button>
          <button onclick="editarContacto('contact1')">
            ‚úèÔ∏è Editar
          </button>
        </div>
      </div>
    </div>
    
    <div class="add-contact">
      <button onclick="agregarContactoEmergencia()">
        ‚ûï Agregar Contacto de Emergencia
      </button>
    </div>
  </div>
  
  <!-- Hoteles de Emergencia -->
  <div class="emergency-hotels">
    <h3>Hoteles de Emergencia</h3>
    <div class="hotels-list">
      <div class="hotel-item">
        <div class="hotel-info">
          <h4>Hotel Central</h4>
          <p>üìç Av. Principal 456</p>
          <p>üí∞ S/. 80 por noche</p>
          <p>üìû +51 999 333 444</p>
          <p>üö∂ 5 min del evento</p>
        </div>
        <div class="hotel-actions">
          <button onclick="reservarHotel('hotel1')">
            üìû Reservar
          </button>
          <button onclick="verDetalles('hotel1')">
            üëÅÔ∏è Ver Detalles
          </button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Protocolo de Cancelaci√≥n -->
  <div class="cancellation-protocol">
    <h3>Protocolo de Cancelaci√≥n</h3>
    <div class="protocol-steps">
      <div class="step">
        <h4>Paso 1: Contactar Anfitri√≥n de Backup</h4>
        <p>Contactar inmediatamente a los anfitriones de backup en orden de prioridad</p>
      </div>
      <div class="step">
        <h4>Paso 2: Notificar al Visitante</h4>
        <p>Informar al visitante sobre el cambio y proporcionar nueva informaci√≥n de contacto</p>
      </div>
      <div class="step">
        <h4>Paso 3: Actualizar Sistema</h4>
        <p>Actualizar el estado en el sistema y registrar el incidente</p>
      </div>
      <div class="step">
        <h4>Paso 4: Seguimiento</h4>
        <p>Hacer seguimiento para confirmar que el nuevo arreglo funciona correctamente</p>
      </div>
    </div>
  </div>
</div>
```

## üîß L√ìGICA JAVASCRIPT ACTUALIZADA

### 1. üì± Sistema de Notificaciones Internas
```javascript
// notifications.js
class NotificationSystem {
  constructor() {
    this.userId = firebase.auth().currentUser.uid;
  }
  
  async updateProfileNotifications() {
    try {
      const userDoc = await firebase.firestore()
        .collection('usuarios')
        .doc(this.userId)
        .get();
      
      const userData = userDoc.data();
      const notifications = userData.notificaciones_internas || {};
      
      // Actualizar estado de verificaci√≥n
      this.updateVerificationStatus(notifications.verificacion_estado);
      
      // Actualizar postulaciones
      this.updateApplications(notifications.postulaciones || []);
      
      // Actualizar asignaciones
      this.updateAssignments(notifications.asignaciones_actuales || []);
      
      // Actualizar mensajes del admin
      this.updateAdminMessages(notifications.mensajes_admin || []);
      
    } catch (error) {
      console.error('Error updating notifications:', error);
    }
  }
  
  updateVerificationStatus(status) {
    const badge = document.getElementById('verificationBadge');
    if (!badge) return;
    
    badge.className = `status-badge ${status}`;
    
    switch (status) {
      case 'pendiente':
        badge.innerHTML = '‚è≥ Verificaci√≥n Pendiente';
        badge.classList.add('pending');
        break;
      case 'completada':
        badge.innerHTML = '‚úÖ Verificado';
        badge.classList.add('verified');
        break;
      case 'rechazada':
        badge.innerHTML = '‚ùå Verificaci√≥n Rechazada';
        badge.classList.add('rejected');
        break;
    }
  }
  
  updateApplications(applications) {
    const container = document.querySelector('.applications-list');
    if (!container) return;
    
    container.innerHTML = '';
    
    applications.forEach(app => {
      const appDiv = document.createElement('div');
      appDiv.className = 'application-item';
      
      const statusClass = this.getStatusClass(app.estado);
      const statusText = this.getStatusText(app.estado);
      
      appDiv.innerHTML = `
        <div class="application-info">
          <h4>${app.evento_nombre}</h4>
          <p>Tipo: ${app.tipo === 'hospedador' ? 'Anfitri√≥n' : 'Visitante'}</p>
          <p>Fecha: ${new Date(app.fecha_postulacion).toLocaleDateString()}</p>
        </div>
        <div class="application-status">
          <span class="status-badge ${statusClass}">${statusText}</span>
        </div>
      `;
      
      container.appendChild(appDiv);
    });
  }
  
  getStatusClass(estado) {
    const classes = {
      'postulado': 'pending',
      'verificado': 'verified',
      'asignado': 'assigned',
      'rechazado': 'rejected'
    };
    return classes[estado] || 'unknown';
  }
  
  getStatusText(estado) {
    const texts = {
      'postulado': 'üìã Postulado',
      'verificado': '‚úÖ Verificado',
      'asignado': 'ü§ù Asignado',
      'rechazado': '‚ùå Rechazado'
    };
    return texts[estado] || 'Estado desconocido';
  }
}

// Inicializar sistema de notificaciones
document.addEventListener('DOMContentLoaded', () => {
  const notificationSystem = new NotificationSystem();
  
  // Actualizar notificaciones cada 30 segundos
  setInterval(() => {
    notificationSystem.updateProfileNotifications();
  }, 30000);
  
  // Actualizar inmediatamente
  notificationSystem.updateProfileNotifications();
});
```

### 2. üîç Sistema de Verificaci√≥n Manual
```javascript
// verification.js
class VerificationSystem {
  constructor() {
    this.db = firebase.firestore();
    this.currentUser = firebase.auth().currentUser;
  }
  
  async iniciarVerificacion(userId, method = 'whatsapp') {
    try {
      const verificationData = {
        usuario_id: userId,
        admin_verificador: this.currentUser.uid,
        fecha_inicio: firebase.firestore.FieldValue.serverTimestamp(),
        metodo: method,
        estado: 'en_proceso',
        verificaciones: {
          identidad: false,
          telefono: false,
          direccion: false,
          referencias_cristianas: false,
          antecedentes: false
        }
      };
      
      const docRef = await this.db.collection('verificaciones_manuales').add(verificationData);
      
      // Mostrar formulario de verificaci√≥n
      this.showVerificationForm(userId, docRef.id);
      
    } catch (error) {
      console.error('Error iniciando verificaci√≥n:', error);
      alert('Error al iniciar verificaci√≥n');
    }
  }
  
  showVerificationForm(userId, verificationId) {
    const form = document.getElementById('verificationForm');
    const userIdInput = document.getElementById('userId');
    
    form.style.display = 'block';
    userIdInput.value = userId;
    form.setAttribute('data-verification-id', verificationId);
  }
  
  async aprobarVerificacion() {
    const form = document.getElementById('verificationForm');
    const verificationId = form.getAttribute('data-verification-id');
    const userId = document.getElementById('userId').value;
    const notes = document.getElementById('verificationNotes').value;
    
    // Recopilar verificaciones realizadas
    const checkboxes = form.querySelectorAll('input[type="checkbox"]');
    const verificaciones = {};
    
    checkboxes.forEach(checkbox => {
      verificaciones[checkbox.name] = checkbox.checked;
    });
    
    try {
      // Actualizar documento de verificaci√≥n
      await this.db.collection('verificaciones_manuales').doc(verificationId).update({
        fecha_completada: firebase.firestore.FieldValue.serverTimestamp(),
        resultado: 'aprobado',
        notas_verificador: notes,
        verificaciones: verificaciones
      });
      
      // Actualizar estado del usuario
      await this.db.collection('usuarios').doc(userId).update({
        'verificacion.estado': 'verificado',
        'verificacion.fecha_verificacion': firebase.firestore.FieldValue.serverTimestamp(),
        'verificacion.verificado_por': this.currentUser.uid,
        'verificacion.notas_verificador': notes,
        'valoracion.base_verificacion': 1 // +1 estrella por verificaci√≥n
      });
      
      alert('Verificaci√≥n aprobada exitosamente');
      this.hideVerificationForm();
      this.loadPendingVerifications();
      
    } catch (error) {
      console.error('Error aprobando verificaci√≥n:', error);
      alert('Error al aprobar verificaci√≥n');
    }
  }
  
  async rechazarVerificacion() {
    const form = document.getElementById('verificationForm');
    const verificationId = form.getAttribute('data-verification-id');
    const userId = document.getElementById('userId').value;
    const notes = document.getElementById('verificationNotes').value;
    
    try {
      // Actualizar documento de verificaci√≥n
      await this.db.collection('verificaciones_manuales').doc(verificationId).update({
        fecha_completada: firebase.firestore.FieldValue.serverTimestamp(),
        resultado: 'rechazado',
        notas_verificador: notes
      });
      
      // Actualizar estado del usuario
      await this.db.collection('usuarios').doc(userId).update({
        'verificacion.estado': 'rechazado',
        'verificacion.fecha_verificacion': firebase.firestore.FieldValue.serverTimestamp(),
        'verificacion.verificado_por': this.currentUser.uid,
        'verificacion.notas_verificador': notes
      });
      
      alert('Verificaci√≥n rechazada');
      this.hideVerificationForm();
      this.loadPendingVerifications();
      
    } catch (error) {
      console.error('Error rechazando verificaci√≥n:', error);
      alert('Error al rechazar verificaci√≥n');
    }
  }
}
```

### 3. ü§ù Sistema de Emparejamiento Manual
```javascript
// matching-manual.js
class ManualMatchingSystem {
  constructor() {
    this.db = firebase.firestore();
    this.currentUser = firebase.auth().currentUser;
  }
  
  async loadEventParticipants() {
    const eventId = document.getElementById('eventSelect').value;
    if (!eventId) return;
    
    try {
      // Cargar anfitriones
      const hosts = await this.loadHosts(eventId);
      this.displayHosts(hosts);
      
      // Cargar visitantes
      const visitors = await this.loadVisitors(eventId);
      this.displayVisitors(visitors);
      
      // Generar sugerencias
      const suggestions = this.generateSuggestions(hosts, visitors);
      this.displaySuggestions(suggestions);
      
    } catch (error) {
      console.error('Error loading participants:', error);
    }
  }
  
  async loadHosts(eventId) {
    const snapshot = await this.db.collection('postulaciones')
      .where('evento_id', '==', eventId)
      .where('tipo', '==', 'hospedador')
      .where('estado', '==', 'verificado')
      .get();
    
    const hosts = [];
    for (const doc of snapshot.docs) {
      const postulacion = doc.data();
      const userDoc = await this.db.collection('usuarios').doc(postulacion.usuario_id).get();
      const userData = userDoc.data();
      
      hosts.push({
        id: doc.id,
        userId: postulacion.usuario_id,
        userData: userData,
        datos: postulacion.datos_hospedador,
        valoracion: userData.valoracion?.promedio_total || 0
      });
    }
    
    return hosts;
  }
  
    async loadVisitors(eventId) {
        try {
            const visitorsRef = collection(db, 'postulaciones');
            const q = query(
                visitorsRef,
                where('evento_id', '==', eventId),
                where('tipo', '==', 'visitante'),
                where('estado', '==', 'verificado')
            );
            
            const snapshot = await getDocs(q);
            const visitors = [];
            
            for (const doc of snapshot.docs) {
                const postulacion = doc.data();
                const userDoc = await getDoc(doc(db, 'usuarios', postulacion.usuario_id));
                
                if (userDoc.exists()) {
                    visitors.push({
                        id: doc.id,
                        postulacion: postulacion,
                        usuario: userDoc.data(),
                        userId: postulacion.usuario_id
                    });
                }
            }
            
            return visitors;
        } catch (error) {
            console.error('Error cargando visitantes:', error);
            return [];
        }
    }

    // SISTEMA DE VALORACI√ìN CRISTIANA
    async displayChristianRating(userId, containerId) {
        try {
            const userDoc = await getDoc(doc(db, 'usuarios', userId));
            const userData = userDoc.data();
            
            const container = document.getElementById(containerId);
            
            if (!userData.valoracion) {
                container.innerHTML = `
                    <div class="rating-display">
                        <div class="stars">‚≠ê‚≠ê</div>
                        <p class="rating-text">Nuevo usuario (2 estrellas base)</p>
                        <small>Valoraci√≥n basada en comportamiento cristiano</small>
                    </div>
                `;
                return;
            }
            
            const totalStars = userData.valoracion.promedio_total || 2;
            const starDisplay = '‚≠ê'.repeat(Math.floor(totalStars));
            
            container.innerHTML = `
                <div class="rating-display">
                    <div class="stars">${starDisplay}</div>
                    <p class="rating-text">${totalStars.toFixed(1)} estrellas</p>
                    <p class="rating-count">${userData.valoracion.total_valoraciones || 0} valoraciones</p>
                    <small>Basada en comportamiento cristiano y hospitalidad</small>
                </div>
            `;
            
        } catch (error) {
            console.error('Error mostrando valoraci√≥n:', error);
        }
    }

    // SISTEMA DE NOTIFICACIONES INTERNAS (SIN COSTO)
    async updateUserNotifications(userId, eventId, type, status) {
        try {
            const userRef = doc(db, 'usuarios', userId);
            const userDoc = await getDoc(userRef);
            
            if (!userDoc.exists()) return;
            
            const userData = userDoc.data();
            let notifications = userData.notificaciones_internas || {
                verificacion_estado: 'pendiente',
                postulaciones: [],
                asignaciones_actuales: [],
                mensajes_admin: []
            };
            
            // Actualizar postulaciones
            const existingPostulation = notifications.postulaciones.find(p => 
                p.evento_id === eventId && p.tipo === type
            );
            
            if (existingPostulation) {
                existingPostulation.estado = status;
                existingPostulation.fecha_actualizacion = new Date();
            } else {
                notifications.postulaciones.push({
                    evento_id: eventId,
                    tipo: type,
                    estado: status,
                    fecha_postulacion: new Date(),
                    fecha_actualizacion: new Date()
                });
            }
            
            await updateDoc(userRef, {
                notificaciones_internas: notifications
            });
            
        } catch (error) {
            console.error('Error actualizando notificaciones:', error);
        }
    }

    // SISTEMA DE VERIFICACI√ìN MANUAL
    async iniciarVerificacion(userId, method = 'whatsapp') {
        try {
            const currentUser = auth.currentUser;
            if (!currentUser) throw new Error('Usuario no autenticado');
            
            const verificationData = {
                usuario_id: userId,
                admin_verificador: currentUser.uid,
                fecha_inicio: new Date(),
                metodo: method,
                estado: 'en_proceso',
                verificaciones: {
                    identidad: false,
                    telefono: false,
                    direccion: false,
                    referencias_cristianas: false,
                    antecedentes: false
                }
            };
            
            const verificationRef = await addDoc(collection(db, 'verificaciones_manuales'), verificationData);
            
            // Mostrar formulario de verificaci√≥n
            this.showVerificationForm(userId, verificationRef.id);
            
        } catch (error) {
            console.error('Error iniciando verificaci√≥n:', error);
            alert('Error al iniciar verificaci√≥n');
        }
    }

    showVerificationForm(userId, verificationId) {
        const form = document.getElementById('verificationForm');
        form.style.display = 'block';
        form.setAttribute('data-user-id', userId);
        form.setAttribute('data-verification-id', verificationId);
        
        // Cargar datos del usuario
        this.loadUserForVerification(userId);
    }

    async loadUserForVerification(userId) {
        try {
            const userDoc = await getDoc(doc(db, 'usuarios', userId));
            if (userDoc.exists()) {
                const userData = userDoc.data();
                
                // Llenar informaci√≥n del usuario en el formulario
                document.querySelector('.user-verification-info').innerHTML = `
                    <h4>Verificando a: ${userData.nombre} ${userData.apellido}</h4>
                    <p><strong>Tel√©fono:</strong> ${userData.telefono}</p>
                    <p><strong>Email:</strong> ${userData.email}</p>
                    <p><strong>Fecha registro:</strong> ${userData.createdAt?.toDate().toLocaleDateString()}</p>
                `;
            }
        } catch (error) {
            console.error('Error cargando usuario para verificaci√≥n:', error);
        }
    }

    async aprobarVerificacion() {
        try {
            const form = document.getElementById('verificationForm');
            const userId = form.getAttribute('data-user-id');
            const verificationId = form.getAttribute('data-verification-id');
            
            const checkboxes = form.querySelectorAll('input[type="checkbox"]');
            const verificaciones = {};
            
            checkboxes.forEach(checkbox => {
                verificaciones[checkbox.name] = checkbox.checked;
            });
            
            const notas = document.getElementById('verificationNotes').value;
            const metodo = document.getElementById('verificationMethod').value;
            
            // Actualizar verificaci√≥n manual
            await updateDoc(doc(db, 'verificaciones_manuales', verificationId), {
                verificaciones: verificaciones,
                resultado: 'aprobado',
                notas_verificador: notas,
                metodo: metodo,
                fecha_completada: new Date()
            });
            
            // Actualizar usuario - cambiar estado y dar estrella
            const userRef = doc(db, 'usuarios', userId);
            await updateDoc(userRef, {
                'verificacion.estado': 'verificado',
                'verificacion.fecha_verificacion': new Date(),
                'verificacion.verificado_por': auth.currentUser.uid,
                'verificacion.metodo_verificacion': metodo,
                'verificacion.notas_verificador': notas,
                'valoracion.base_verificacion': 1,
                'notificaciones_internas.verificacion_estado': 'completada'
            });
            
            // Recalcular valoraci√≥n total
            await this.recalculateUserRating(userId);
            
            alert('Verificaci√≥n aprobada exitosamente. Usuario habilitado.');
            this.loadPendingVerifications();
            form.style.display = 'none';
            
        } catch (error) {
            console.error('Error aprobando verificaci√≥n:', error);
            alert('Error al aprobar verificaci√≥n');
        }
    }

    async rechazarVerificacion() {
        try {
            const form = document.getElementById('verificationForm');
            const userId = form.getAttribute('data-user-id');
            const verificationId = form.getAttribute('data-verification-id');
            
            const notas = document.getElementById('verificationNotes').value;
            
            if (!notas.trim()) {
                alert('Por favor, indique el motivo del rechazo');
                return;
            }
            
            // Actualizar verificaci√≥n manual
            await updateDoc(doc(db, 'verificaciones_manuales', verificationId), {
                resultado: 'rechazado',
                notas_verificador: notas,
                fecha_completada: new Date()
            });
            
            // Actualizar usuario
            await updateDoc(doc(db, 'usuarios', userId), {
                'verificacion.estado': 'rechazado',
                'verificacion.fecha_verificacion': new Date(),
                'verificacion.verificado_por': auth.currentUser.uid,
                'verificacion.notas_verificador': notas,
                'notificaciones_internas.verificacion_estado': 'rechazada'
            });
            
            alert('Verificaci√≥n rechazada');
            this.loadPendingVerifications();
            form.style.display = 'none';
            
        } catch (error) {
            console.error('Error rechazando verificaci√≥n:', error);
            alert('Error al rechazar verificaci√≥n');
        }
    }

    async recalculateUserRating(userId) {
        try {
            const userDoc = await getDoc(doc(db, 'usuarios', userId));
            if (!userDoc.exists()) return;
            
            const userData = userDoc.data();
            let totalStars = 0;
            
            // Estrellas base
            totalStars += userData.valoracion?.base_registro || 1;
            totalStars += userData.valoracion?.base_verificacion || 0;
            
            // Estrellas de valoraciones
            if (userData.valoracion?.valoraciones_recibidas) {
                const valoraciones = userData.valoracion.valoraciones_recibidas;
                if (valoraciones.length > 0) {
                    const sum = valoraciones.reduce((acc, val) => acc + val.puntos, 0);
                    const promedio = sum / valoraciones.length;
                    totalStars += promedio;
                }
            }
            
            // Actualizar promedio total
            await updateDoc(doc(db, 'usuarios', userId), {
                'valoracion.promedio_total': totalStars,
                'valoracion.total_valoraciones': userData.valoracion?.valoraciones_recibidas?.length || 0
            });
            
        } catch (error) {
            console.error('Error recalculando valoraci√≥n:', error);
        }
    }

    // SISTEMA DE BACKUP Y CONTINGENCIA
    async setupBackupSystem(eventId) {
        try {
            const eventDoc = await getDoc(doc(db, 'eventos', eventId));
            if (!eventDoc.exists()) return;
            
            // Cargar anfitriones verificados del evento
            const hostesRef = collection(db, 'postulaciones');
            const q = query(
                hostesRef,
                where('evento_id', '==', eventId),
                where('tipo', '==', 'hospedador'),
                where('estado', '==', 'verificado')
            );
            
            const snapshot = await getDocs(q);
            const availableHosts = [];
            
            snapshot.forEach(doc => {
                const postulacion = doc.data();
                if (postulacion.estado !== 'asignado') {
                    availableHosts.push(postulacion.usuario_id);
                }
            });
            
            // Actualizar lista de backup
            await updateDoc(doc(db, 'eventos', eventId), {
                'contingencia.anfitriones_backup': availableHosts.slice(0, 5),
                'contingencia.fecha_actualizacion': new Date()
            });
            
        } catch (error) {
            console.error('Error configurando sistema de backup:', error);
        }
    }

    async handleHostCancellation(eventoId, anfitrionId) {
        try {
            // Buscar visitantes asignados a este anfitri√≥n
            const assignmentsRef = collection(db, 'emparejamientos');
            const q = query(
                assignmentsRef,
                where('evento_id', '==', eventoId),
                where('anfitrion_id', '==', anfitrionId),
                where('estado', '==', 'confirmado')
            );
            
            const snapshot = await getDocs(q);
            const affectedVisitors = [];
            
            snapshot.forEach(doc => {
                affectedVisitors.push({
                    id: doc.id,
                    visitante_id: doc.data().visitante_id
                });
            });
            
            // Buscar anfitriones de backup
            const eventDoc = await getDoc(doc(db, 'eventos', eventoId));
            const backupHosts = eventDoc.data().contingencia?.anfitriones_backup || [];
            
            // Intentar reasignar
            for (const visitor of affectedVisitors) {
                if (backupHosts.length > 0) {
                    const backupHostId = backupHosts.shift();
                    await this.createBackupAssignment(eventoId, backupHostId, visitor.visitante_id, visitor.id);
                } else {
                    // Si no hay backup, derivar a hoteles
                    await this.assignToEmergencyHotel(eventoId, visitor.visitante_id);
                }
            }
            
            // Actualizar lista de backup
            await updateDoc(doc(db, 'eventos', eventoId), {
                'contingencia.anfitriones_backup': backupHosts
            });
            
        } catch (error) {
            console.error('Error manejando cancelaci√≥n:', error);
        }
    }

    async createBackupAssignment(eventoId, backupHostId, visitanteId, originalAssignmentId) {
        try {
            // Cancelar asignaci√≥n original
            await updateDoc(doc(db, 'emparejamientos', originalAssignmentId), {
                estado: 'cancelado',
                fecha_cancelacion: new Date()
            });
            
            // Crear nueva asignaci√≥n de backup
            const backupAssignment = {
                evento_id: eventoId,
                anfitrion_id: backupHostId,
                visitante_id: visitanteId,
                es_asignacion_backup: true,
                emparejamiento_original: originalAssignmentId,
                confirmado_por_admin: auth.currentUser.uid,
                fecha_confirmacion: new Date(),
                estado: 'confirmado',
                motivo_backup: 'Cancelaci√≥n de anfitri√≥n original'
            };
            
            await addDoc(collection(db, 'emparejamientos'), backupAssignment);
            
            // Notificar a ambos usuarios
            await this.notifyBackupAssignment(backupHostId, visitanteId, eventoId);
            
        } catch (error) {
            console.error('Error creando asignaci√≥n de backup:', error);
        }
    }

    async notifyBackupAssignment(hostId, visitanteId, eventoId) {
        try {
            // Notificar al nuevo anfitri√≥n
            await this.addAdminMessage(hostId, 
                'Te hemos asignado un visitante como anfitri√≥n de backup. Revisa tu perfil para m√°s detalles.'
            );
            
            // Notificar al visitante
            await this.addAdminMessage(visitanteId, 
                'Tu alojamiento ha sido reasignado por una cancelaci√≥n. Revisa tu perfil para los nuevos detalles.'
            );
            
        } catch (error) {
            console.error('Error notificando asignaci√≥n de backup:', error);
        }
    }

    async addAdminMessage(userId, mensaje) {
        try {
            const userRef = doc(db, 'usuarios', userId);
            const userDoc = await getDoc(userRef);
            
            if (!userDoc.exists()) return;
            
            const userData = userDoc.data();
            let notifications = userData.notificaciones_internas || {};
            
            if (!notifications.mensajes_admin) {
                notifications.mensajes_admin = [];
            }
            
            notifications.mensajes_admin.push({
                mensaje: mensaje,
                fecha: new Date(),
                leido: false
            });
            
            await updateDoc(userRef, {
                notificaciones_internas: notifications
            });
            
        } catch (error) {
            console.error('Error a√±adiendo mensaje admin:', error);
        }
    }

    // SISTEMA DE OBSERVACIONES POR EVENTO
    async createEventObservation(eventoId, tipo, titulo, descripcion, gravedad = 'media') {
        try {
            const observationData = {
                evento_id: eventoId,
                admin_id: auth.currentUser.uid,
                fecha: new Date(),
                tipo: tipo,
                gravedad: gravedad,
                titulo: titulo,
                descripcion: descripcion,
                estado: 'abierto',
                usuarios_involucrados: [],
                acciones_tomadas: '',
                responsable_seguimiento: auth.currentUser.uid
            };
            
            await addDoc(collection(db, 'observaciones_eventos'), observationData);
            
            // Recargar observaciones
            this.loadEventObservations(eventoId);
            
        } catch (error) {
            console.error('Error creando observaci√≥n:', error);
        }
    }

    async loadEventObservations(eventoId) {
        try {
            const observationsRef = collection(db, 'observaciones_eventos');
            const q = query(
                observationsRef,
                where('evento_id', '==', eventoId),
                orderBy('fecha', 'desc')
            );
            
            const snapshot = await getDocs(q);
            const observations = [];
            
            snapshot.forEach(doc => {
                observations.push({
                    id: doc.id,
                    ...doc.data()
                });
            });
            
            this.displayObservations(observations);
            
        } catch (error) {
            console.error('Error cargando observaciones:', error);
        }
    }

    displayObservations(observations) {
        const container = document.getElementById('observationsList');
        if (!container) return;
        
        container.innerHTML = observations.map(obs => `
            <div class="observation-item ${obs.gravedad}">
                <div class="observation-header">
                    <h4>${obs.titulo}</h4>
                    <span class="gravity-badge ${obs.gravedad}">${obs.gravedad}</span>
                    <span class="status-badge ${obs.estado}">${obs.estado}</span>
                </div>
                <div class="observation-body">
                    <p><strong>Tipo:</strong> ${obs.tipo}</p>
                    <p><strong>Descripci√≥n:</strong> ${obs.descripcion}</p>
                    <p><strong>Fecha:</strong> ${obs.fecha.toDate().toLocaleDateString()}</p>
                    ${obs.acciones_tomadas ? `<p><strong>Acciones:</strong> ${obs.acciones_tomadas}</p>` : ''}
                </div>
                <div class="observation-actions">
                    <button onclick="editObservation('${obs.id}')">Editar</button>
                    <button onclick="resolveObservation('${obs.id}')">Resolver</button>
                </div>
            </div>
        `).join('');
    }

    // SISTEMA DE VALORACI√ìN BIDIRECCIONAL
    async enableMutualRating(eventoId) {
        try {
            // Buscar todos los emparejamientos confirmados del evento
            const matchingsRef = collection(db, 'emparejamientos');
            const q = query(
                matchingsRef,
                where('evento_id', '==', eventoId),
                where('estado', '==', 'confirmado')
            );
            
            const snapshot = await getDocs(q);
            
            // Habilitar valoraci√≥n mutua para cada emparejamiento
            snapshot.forEach(async (doc) => {
                const matching = doc.data();
                await this.createRatingOpportunity(
                    eventoId,
                    matching.anfitrion_id,
                    matching.visitante_id,
                    doc.id
                );
            });
            
        } catch (error) {
            console.error('Error habilitando valoraci√≥n mutua:', error);
        }
    }

    async createRatingOpportunity(eventoId, anfitrionId, visitanteId, emparejamientoId) {
        try {
            // Crear oportunidad de valoraci√≥n para el anfitri√≥n
            await this.addAdminMessage(anfitrionId, 
                `Ya puedes valorar a tu visitante del evento. La valoraci√≥n se basa en comportamiento cristiano.`
            );
            
            // Crear oportunidad de valoraci√≥n para el visitante
            await this.addAdminMessage(visitanteId, 
                `Ya puedes valorar a tu anfitri√≥n del evento. La valoraci√≥n se basa en comportamiento cristiano.`
            );
            
        } catch (error) {
            console.error('Error creando oportunidad de valoraci√≥n:', error);
        }
    }

    async submitChristianRating(eventoId, valoradoId, criterios, comentario) {
        try {
            const ratingData = {
                evento_id: eventoId,
                valorador_id: auth.currentUser.uid,
                valorado_id: valoradoId,
                criterios: criterios,
                comentario_positivo: comentario,
                fecha_valoracion: new Date(),
                verificado_por_admin: false,
                aclaracion: "Esta valoraci√≥n se basa en el comportamiento cristiano y el trato recibido, NO en la calidad material del alojamiento o lujos ofrecidos"
            };
            
            // Calcular promedio de criterios
            const criteriosArray = Object.values(criterios);
            const promedio = criteriosArray.reduce((a, b) => a + b, 0) / criteriosArray.length;
            ratingData.puntos = promedio;
            
            // Determinar tipo de relaci√≥n
            const matchingRef = collection(db, 'emparejamientos');
            const q = query(
                matchingRef,
                where('evento_id', '==', eventoId),
                where('anfitrion_id', '==', valoradoId),
                where('visitante_id', '==', auth.currentUser.uid)
            );
            
            const snapshot = await getDocs(q);
            if (!snapshot.empty) {
                ratingData.tipo_relacion = 'visitante_a_anfitrion';
            } else {
                ratingData.tipo_relacion = 'anfitrion_a_visitante';
            }
            
            // Guardar valoraci√≥n
            await addDoc(collection(db, 'valoraciones_cristianas'), ratingData);
            
            // Actualizar valoraci√≥n del usuario valorado
            await this.updateUserRating(valoradoId, ratingData);
            
            alert('Valoraci√≥n enviada exitosamente');
            
        } catch (error) {
            console.error('Error enviando valoraci√≥n:', error);
            alert('Error al enviar valoraci√≥n');
        }
    }

    async updateUserRating(userId, newRating) {
        try {
            const userRef = doc(db, 'usuarios', userId);
            const userDoc = await getDoc(userRef);
            
            if (!userDoc.exists()) return;
            
            const userData = userDoc.data();
            let valoracion = userData.valoracion || {
                base_registro: 1,
                base_verificacion: 0,
                valoraciones_recibidas: []
            };
            
            // A√±adir nueva valoraci√≥n
            valoracion.valoraciones_recibidas.push({
                evento_id: newRating.evento_id,
                valorador_id: newRating.valorador_id,
                puntos: newRating.puntos,
                comentario: newRating.comentario_positivo,
                criterios: newRating.criterios,
                fecha_valoracion: newRating.fecha_valoracion
            });
            
            // Recalcular promedio
            await updateDoc(userRef, { valoracion: valoracion });
            await this.recalculateUserRating(userId);
            
        } catch (error) {
            console.error('Error actualizando valoraci√≥n del usuario:', error);
        }
    }

    // INICIALIZACI√ìN DEL SISTEMA
    async initialize() {
        try {
            // Verificar autenticaci√≥n
            auth.onAuthStateChanged(async (user) => {
                if (user) {
                    await this.loadUserRole(user.uid);
                    await this.initializeInterface();
                } else {
                    window.location.href = '/auth/login.html';
                }
            });
            
        } catch (error) {
            console.error('Error inicializando sistema:', error);
        }
    }

    async initializeInterface() {
        const userRole = this.currentUserRole;
        
        if (userRole === 'administrador') {
            this.loadPendingVerifications();
            this.loadEventObservations();
            this.setupBackupSystem();
        } else if (userRole === 'editor') {
            this.loadAssignedEvents();
            this.loadAssignedVerifications();
        } else {
            this.loadUserProfile();
            this.loadUserNotifications();
        }
    }
}

// Inicializar el sistema
const hospitalitySystem = new HospitalitySystem();
hospitalitySystem.initialize();




