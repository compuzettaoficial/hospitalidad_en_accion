<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hospitalidad en Acci√≥n</title>
  <link rel="stylesheet" href="css/styles.css">
  <!-- Firebase v8 -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
</head>
<body>
  <header class="header">
    <div class="container">
      <div class="nav-brand">
        <h1>üè† Hospitalidad en Acci√≥n</h1>
      </div>
      <nav class="nav-menu">
        <a href="#" class="nav-link" onclick="showSection('eventos')">Eventos</a>
        <a href="#" class="nav-link" onclick="showSection('profile')" id="profileLink" style="display:none;">Mi Perfil</a>
        <a href="#" class="nav-link" onclick="showLogin()" id="loginLink">Iniciar Sesi√≥n</a>
        <a href="#" class="nav-link" onclick="logout()" id="logoutLink" style="display:none;">Cerrar Sesi√≥n</a>
      </nav>
    </div>
  </header>

  <main class="main-content">
    <section id="eventos" class="section active">
      <div class="container">
        <div class="welcome-banner">
          <h2>Bienvenido a Hospitalidad en Acci√≥n</h2>
          <p>Conectamos eventos cristianos con anfitriones y visitantes</p>
        </div>
        <div class="events-grid" id="eventsGrid">
          <div class="loading">Cargando eventos...</div>
        </div>
      </div>
    </section>
  </main>

  <footer class="footer">
    <div class="container">
      <p>&copy; 2024 Hospitalidad en Acci√≥n - Derechos reservados: N√©stor Manrique</p>
    </div>
  </footer>

  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyBFaCbNqpd93Eirj7NDnkKtOS6Ym0rMoiA",
      authDomain: "hospitalidad-29c5c.firebaseapp.com",
      projectId: "hospitalidad-29c5c",
      storageBucket: "hospitalidad-29c5c.appspot.com",
      messagingSenderId: "1061561367897",
      appId: "1:1061561367897:web:57921b5aa3eb7bc3132048"
    };
    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }
    const db = firebase.firestore();
    const auth = firebase.auth();

    function showSection(id) {
      document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
      document.getElementById(id).classList.add('active');
    }

    function showLogin() {
      showSection('login');
    }

    function logout() {
      auth.signOut().then(() => {
        document.getElementById('loginLink').style.display = 'block';
        document.getElementById('logoutLink').style.display = 'none';
        document.getElementById('profileLink').style.display = 'none';
        showSection('eventos');
      });
    }

    auth.onAuthStateChanged(user => {
      if (user) {
        document.getElementById('loginLink').style.display = 'none';
        document.getElementById('logoutLink').style.display = 'block';
        document.getElementById('profileLink').style.display = 'block';
      } else {
        document.getElementById('loginLink').style.display = 'block';
        document.getElementById('logoutLink').style.display = 'none';
        document.getElementById('profileLink').style.display = 'none';
      }
    });

    function loadEvents() {
      const eventsGrid = document.getElementById('eventsGrid');
      db.collection('eventos').orderBy('fecha_inicio', 'asc').get()
        .then(snapshot => {
          if (snapshot.empty) {
            eventsGrid.innerHTML = '<div class="loading">No hay eventos disponibles.</div>';
            return;
          }
          eventsGrid.innerHTML = '';
          snapshot.forEach(doc => {
            const evento = doc.data();
            const card = document.createElement('div');
            card.className = 'event-card';
            card.onclick = () => window.location.href = `event-detail.html?id=${doc.id}`;

            // ‚úÖ CAMBIO IMPORTANTE:
            // Usamos <img> real si existe imagenURL; si no, mostramos un √≠cono por defecto.
            const imgHTML = evento.imagenURL
              ? `<img src="${evento.imagenURL}" alt="Imagen del evento" class="event-image" style="width:100%; height:200px; object-fit:cover; border-radius:10px; margin-bottom:1rem;">`
              : `<div class="event-image">üìÖ</div>`;

            const fecha = evento.fecha_inicio?.toDate 
              ? evento.fecha_inicio.toDate().toLocaleDateString('es-ES')
              : new Date(evento.fecha_inicio).toLocaleDateString('es-ES');

            card.innerHTML = `
              ${imgHTML}
              <div class="event-title">${evento.titulo || 'Sin t√≠tulo'}</div>
              <div class="event-description">${evento.descripcion?.substring(0,100) || 'Sin descripci√≥n'}...</div>
              <div class="event-meta">
                <span>üìç ${evento.lugar || 'Lugar no especificado'}</span>
                <span>üìÖ ${fecha}</span>
              </div>
            `;
            eventsGrid.appendChild(card);
          });
        })
        .catch(err => {
          console.error('Error cargando eventos:', err);
          eventsGrid.innerHTML = `<div class="loading">Error al cargar eventos.</div>`;
        });
    }

    document.addEventListener('DOMContentLoaded', loadEvents);
  </script>
</body>
</html>
