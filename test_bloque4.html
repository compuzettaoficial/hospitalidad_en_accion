<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Bloque 4 - Firebase Services</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        .container { max-width: 1400px; margin: 0 auto; }
        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .status {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 600;
            text-align: center;
        }
        .status.loading { background: #fff3cd; color: #856404; }
        .status.success { background: #d4edda; color: #155724; }
        .status.error { background: #f8d7da; color: #721c24; }
        .section {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .section h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.5rem;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }
        .buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        button {
            padding: 12px 24px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        button:hover { background: #5568d3; transform: translateY(-2px); }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        button.danger { background: #dc3545; }
        button.danger:hover { background: #c82333; }
        button.success { background: #28a745; }
        button.success:hover { background: #218838; }
        .output {
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            max-height: 400px;
            overflow-y: auto;
        }
        .output pre {
            margin: 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .result-item {
            padding: 10px;
            margin: 5px 0;
            background: white;
            border-left: 4px solid #667eea;
            border-radius: 4px;
        }
        .result-item.success { border-left-color: #28a745; }
        .result-item.error { border-left-color: #dc3545; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
        }
        .card h3 { color: #333; margin-bottom: 10px; font-size: 1.1rem; }
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 600;
            margin: 2px;
        }
        .badge.success { background: #d4edda; color: #155724; }
        .badge.error { background: #f8d7da; color: #721c24; }
        .badge.warning { background: #fff3cd; color: #856404; }
        .badge.info { background: #d1ecf1; color: #0c5460; }
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 1rem;
            margin-bottom: 10px;
        }
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        label {
            display: block;
            font-weight: 600;
            margin-bottom: 5px;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Test Bloque 4 - Servicios Firebase</h1>
        
        <div id="status" class="status loading">
            ‚è≥ Verificando carga de servicios...
        </div>

        <!-- AUTH SERVICE -->
        <div class="section" id="auth-section">
            <h2>üîê Auth Service</h2>
            <div class="buttons">
                <button onclick="checkAuthStatus()">‚úì Verificar Estado Auth</button>
                <button onclick="getCurrentUserInfo()">üë§ Info Usuario Actual</button>
                <button onclick="testLogout()" class="danger">üö™ Logout (Prueba)</button>
            </div>
            <div id="auth-output" class="output"></div>
        </div>

        <!-- FIRESTORE SERVICE -->
        <div class="section" id="firestore-section">
            <h2>üî• Firestore Service</h2>
            <div class="buttons">
                <button onclick="testFirestoreRead()">üìñ Test Read</button>
                <button onclick="testFirestoreQuery()">üîç Test Query</button>
                <button onclick="testFirestoreCount()">üî¢ Test Count</button>
            </div>
            <div id="firestore-output" class="output"></div>
        </div>

        <!-- USUARIOS SERVICE -->
        <div class="section" id="usuarios-section">
            <h2>üë• Usuarios Service</h2>
            <div class="buttons">
                <button onclick="testGetAllUsuarios()">üìã Listar Usuarios</button>
                <button onclick="testGetUsuariosStats()">üìä Estad√≠sticas</button>
                <button onclick="testSearchUsuarios()">üîç Buscar Usuario</button>
            </div>
            <div id="usuarios-output" class="output"></div>
        </div>

        <!-- POSTULACIONES SERVICE -->
        <div class="section" id="postulaciones-section">
            <h2>üìù Postulaciones Service</h2>
            <div class="buttons">
                <button onclick="testGetPostulacionesEvento()">üìã Postulaciones Evento AMIP</button>
                <button onclick="testGetMisPostulaciones()">üè† Mis Postulaciones</button>
                <button onclick="showPostularForm()">‚ûï Crear Postulaci√≥n (Demo)</button>
            </div>
            <div id="postulaciones-output" class="output"></div>
        </div>

        <!-- HOSPITALIDAD SERVICE -->
        <div class="section" id="hospitalidad-section">
            <h2>üè† Hospitalidad Service</h2>
            <div class="buttons">
                <button onclick="testGetInfoEvento()">üìä Info Hospitalidad AMIP</button>
                <button onclick="testCanPostular()">‚úì Verificar Puede Postular</button>
                <button onclick="testGetDashboard()">üìà Dashboard Usuario</button>
            </div>
            <div id="hospitalidad-output" class="output"></div>
        </div>

        <!-- MATCHING SERVICE -->
        <div class="section" id="matching-section">
            <h2>ü§ù Matching Service</h2>
            <div class="buttons">
                <button onclick="testGetSugerencias()">üí° Ver Sugerencias Matching</button>
                <button onclick="testCalcularScore()">üéØ Calcular Score (Demo)</button>
            </div>
            <div id="matching-output" class="output"></div>
        </div>

        <!-- TEST COMPLETO -->
        <div class="section">
            <h2>‚úÖ Test Completo</h2>
            <div class="buttons">
                <button onclick="runAllTests()" class="success">üöÄ Ejecutar Todos los Tests</button>
                <button onclick="clearAll()" class="danger">üóëÔ∏è Limpiar Todo</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <!-- Firebase Config (DEBES TENER ESTE ARCHIVO) -->
    <script src="assets/js/config/firebase-config.js"></script>

    <!-- Config -->
    <script src="assets/js/config/env.js"></script>
    <script src="assets/js/config/constants.js"></script>
    <script src="assets/js/config/routes.js"></script>

    <!-- Utils -->
    <script src="assets/js/utils/validators.js"></script>
    <script src="assets/js/utils/formatters.js"></script>
    <script src="assets/js/utils/helpers.js"></script>
    <script src="assets/js/utils/notifications.js"></script>

    <!-- Firebase Services -->
    <script src="assets/js/services/firebase/firestore.service.js"></script>
    <script src="assets/js/services/firebase/auth.service.js"></script>
    <script src="assets/js/services/firebase/usuarios.service.js"></script>

    <!-- API Services -->
    <script src="assets/js/services/api/eventos.api.js"></script>
    <script src="assets/js/services/api/hoteles.api.js"></script>
    <script src="assets/js/services/api/cocheras.api.js"></script>

    <!-- Business Services -->
    <script src="assets/js/services/business/postulaciones.service.js"></script>
    <script src="assets/js/services/business/hospitalidad.service.js"></script>
    <script src="assets/js/services/business/matching.service.js"></script>

    <script>
        const status = document.getElementById('status');
        const eventoIdAMIP = 'amip-chimbote-feb2026';

        // ============================================
        // VERIFICACI√ìN INICIAL
        // ============================================
        window.addEventListener('load', async () => {
            console.log('üß™ Test Bloque 4 cargado');
            
            const servicios = {
                'AuthService': typeof AuthService,
                'FirestoreService': typeof FirestoreService,
                'UsuariosService': typeof UsuariosService,
                'PostulacionesService': typeof PostulacionesService,
                'HospitalidadService': typeof HospitalidadService,
                'MatchingService': typeof MatchingService,
                'EventosAPI': typeof EventosAPI
            };
            
            console.log('Servicios cargados:', servicios);
            
            const todosCargados = Object.values(servicios).every(t => t === 'object');
            
            if (todosCargados) {
                status.textContent = '‚úÖ Todos los servicios cargados correctamente';
                status.className = 'status success';
            } else {
                status.textContent = '‚ùå Algunos servicios no se cargaron';
                status.className = 'status error';
                console.error('Servicios faltantes:', Object.entries(servicios).filter(([k,v]) => v !== 'object'));
            }
        });

        // ============================================
        // AUTH SERVICE
        // ============================================
        function checkAuthStatus() {
            const output = document.getElementById('auth-output');
            output.innerHTML = '<div class="result-item">‚è≥ Verificando estado...</div>';
            
            const user = firebase.auth().currentUser;
            
            if (user) {
                output.innerHTML = `
                    <div class="result-item success">
                        <strong>‚úÖ Usuario Autenticado</strong>
                        <pre>${JSON.stringify({
                            uid: user.uid,
                            email: user.email,
                            emailVerified: user.emailVerified
                        }, null, 2)}</pre>
                    </div>
                `;
            } else {
                output.innerHTML = `
                    <div class="result-item error">
                        <strong>‚ùå No hay usuario autenticado</strong>
                        <p>Debes iniciar sesi√≥n primero. Ve a /pages/auth/login.html</p>
                    </div>
                `;
            }
        }

        async function getCurrentUserInfo() {
            const output = document.getElementById('auth-output');
            output.innerHTML = '<div class="result-item">‚è≥ Obteniendo datos...</div>';
            
            try {
                const user = firebase.auth().currentUser;
                if (!user) throw new Error('No autenticado');
                
                const userData = await AuthService.getUserData(user.uid);
                
                output.innerHTML = `
                    <div class="result-item success">
                        <strong>‚úÖ Datos del Usuario</strong>
                        <pre>${JSON.stringify(userData, null, 2)}</pre>
                    </div>
                `;
            } catch (error) {
                output.innerHTML = `
                    <div class="result-item error">
                        <strong>‚ùå Error:</strong> ${error.message}
                    </div>
                `;
            }
        }

        function testLogout() {
            if (confirm('‚ö†Ô∏è Esto cerrar√° tu sesi√≥n. ¬øContinuar?')) {
                AuthService.logout();
            }
        }

        // ============================================
        // FIRESTORE SERVICE
        // ============================================
        async function testFirestoreRead() {
            const output = document.getElementById('firestore-output');
            output.innerHTML = '<div class="result-item">‚è≥ Leyendo colecci√≥n usuarios...</div>';
            
            try {
                const user = firebase.auth().currentUser;
                if (!user) throw new Error('Debes iniciar sesi√≥n');
                
                const userData = await FirestoreService.getById('usuarios', user.uid);
                
                output.innerHTML = `
                    <div class="result-item success">
                        <strong>‚úÖ Lectura exitosa</strong>
                        <pre>${JSON.stringify(userData, null, 2)}</pre>
                    </div>
                `;
            } catch (error) {
                output.innerHTML = `
                    <div class="result-item error">
                        <strong>‚ùå Error:</strong> ${error.message}
                    </div>
                `;
            }
        }

        async function testFirestoreQuery() {
            const output = document.getElementById('firestore-output');
            output.innerHTML = '<div class="result-item">‚è≥ Consultando usuarios activos...</div>';
            
            try {
                const usuarios = await FirestoreService.query(
                    'usuarios',
                    [['activo', '==', true]],
                    { limit: 5 }
                );
                
                output.innerHTML = `
                    <div class="result-item success">
                        <strong>‚úÖ Query exitosa</strong>
                        <p>Encontrados: ${usuarios.length} usuarios</p>
                        <pre>${JSON.stringify(usuarios, null, 2)}</pre>
                    </div>
                `;
            } catch (error) {
                output.innerHTML = `
                    <div class="result-item error">
                        <strong>‚ùå Error:</strong> ${error.message}
                    </div>
                `;
            }
        }

        async function testFirestoreCount() {
            const output = document.getElementById('firestore-output');
            output.innerHTML = '<div class="result-item">‚è≥ Contando usuarios...</div>';
            
            try {
                const total = await FirestoreService.count('usuarios');
                const activos = await FirestoreService.count('usuarios', [['activo', '==', true]]);
                
                output.innerHTML = `
                    <div class="result-item success">
                        <strong>‚úÖ Conteo exitoso</strong>
                        <p>Total usuarios: ${total}</p>
                        <p>Usuarios activos: ${activos}</p>
                    </div>
                `;
            } catch (error) {
                output.innerHTML = `
                    <div class="result-item error">
                        <strong>‚ùå Error:</strong> ${error.message}
                    </div>
                `;
            }
        }

        // ============================================
        // USUARIOS SERVICE
        // ============================================
        async function testGetAllUsuarios() {
            const output = document.getElementById('usuarios-output');
            output.innerHTML = '<div class="result-item">‚è≥ Obteniendo usuarios...</div>';
            
            try {
                const usuarios = await UsuariosService.getAll({ limit: 10 });
                
                let html = '<div class="result-item success"><strong>‚úÖ Usuarios encontrados: ' + usuarios.length + '</strong></div>';
                html += '<div class="grid">';
                
                usuarios.forEach(u => {
                    html += `
                        <div class="card">
                            <h3>${u.nombre || 'Sin nombre'}</h3>
                            <p><strong>Email:</strong> ${u.email}</p>
                            <p><strong>Rol:</strong> <span class="badge info">${u.rol}</span></p>
                            <p><strong>Estado:</strong> <span class="badge ${u.activo ? 'success' : 'error'}">${u.activo ? 'Activo' : 'Inactivo'}</span></p>
                        </div>
                    `;
                });
                
                html += '</div>';
                output.innerHTML = html;
            } catch (error) {
                output.innerHTML = `
                    <div class="result-item error">
                        <strong>‚ùå Error:</strong> ${error.message}
                    </div>
                `;
            }
        }

        async function testGetUsuariosStats() {
            const output = document.getElementById('usuarios-output');
            output.innerHTML = '<div class="result-item">‚è≥ Calculando estad√≠sticas...</div>';
            
            try {
                const stats = await UsuariosService.getStats();
                
                output.innerHTML = `
                    <div class="result-item success">
                        <strong>‚úÖ Estad√≠sticas de Usuarios</strong>
                        <pre>${JSON.stringify(stats, null, 2)}</pre>
                    </div>
                `;
            } catch (error) {
                output.innerHTML = `
                    <div class="result-item error">
                        <strong>‚ùå Error:</strong> ${error.message}
                    </div>
                `;
            }
        }

        async function testSearchUsuarios() {
            const output = document.getElementById('usuarios-output');
            const termino = prompt('Ingresa nombre o email para buscar:');
            if (!termino) return;
            
            output.innerHTML = '<div class="result-item">‚è≥ Buscando...</div>';
            
            try {
                const resultados = await UsuariosService.search(termino);
                
                output.innerHTML = `
                    <div class="result-item success">
                        <strong>‚úÖ Resultados: ${resultados.length}</strong>
                        <pre>${JSON.stringify(resultados, null, 2)}</pre>
                    </div>
                `;
            } catch (error) {
                output.innerHTML = `
                    <div class="result-item error">
                        <strong>‚ùå Error:</strong> ${error.message}
                    </div>
                `;
            }
        }

        // ============================================
        // POSTULACIONES SERVICE
        // ============================================
        async function testGetPostulacionesEvento() {
            const output = document.getElementById('postulaciones-output');
            output.innerHTML = '<div class="result-item">‚è≥ Obteniendo postulaciones...</div>';
            
            try {
                const postulaciones = await PostulacionesService.getByEvento(eventoIdAMIP);
                const stats = await PostulacionesService.getEstadisticasEvento(eventoIdAMIP);
                
                let html = `
                    <div class="result-item success">
                        <strong>‚úÖ Postulaciones del Evento AMIP</strong>
                        <h3>Estad√≠sticas:</h3>
                        <pre>${JSON.stringify(stats, null, 2)}</pre>
                    </div>
                `;
                
                if (postulaciones.length > 0) {
                    html += '<div class="grid">';
                    postulaciones.forEach(p => {
                        html += `
                            <div class="card">
                                <h3>Postulaci√≥n ${p.tipo}</h3>
                                <p><strong>Estado:</strong> <span class="badge ${p.estado === 'pendiente' ? 'warning' : 'info'}">${p.estado}</span></p>
                                <p><strong>Usuario:</strong> ${p.usuarioId.substring(0, 8)}...</p>
                            </div>
                        `;
                    });
                    html += '</div>';
                }
                
                output.innerHTML = html;
            } catch (error) {
                output.innerHTML = `
                    <div class="result-item error">
                        <strong>‚ùå Error:</strong> ${error.message}
                    </div>
                `;
            }
        }

        async function testGetMisPostulaciones() {
            const output = document.getElementById('postulaciones-output');
            output.innerHTML = '<div class="result-item">‚è≥ Obteniendo mis postulaciones...</div>';
            
            try {
                const user = firebase.auth().currentUser;
                if (!user) throw new Error('Debes iniciar sesi√≥n');
                
                const postulaciones = await PostulacionesService.getByUsuario(user.uid);
                
                output.innerHTML = `
                    <div class="result-item success">
                        <strong>‚úÖ Mis Postulaciones: ${postulaciones.length}</strong>
                        <pre>${JSON.stringify(postulaciones, null, 2)}</pre>
                    </div>
                `;
            } catch (error) {
                output.innerHTML = `
                    <div class="result-item error">
                        <strong>‚ùå Error:</strong> ${error.message}
                    </div>
                `;
            }
        }

        function showPostularForm() {
            alert('üìù Formulario de postulaci√≥n\n\nEsta funcionalidad se implementar√° en las p√°ginas HTML del proyecto.\n\nPor ahora puedes probar los otros m√©todos de lectura.');
        }

        // ============================================
        // HOSPITALIDAD SERVICE
        // ============================================
        async function testGetInfoEvento() {
            const output = document.getElementById('hospitalidad-output');
            output.innerHTML = '<div class="result-item">‚è≥ Obteniendo informaci√≥n...</div>';
            
            try {
                const info = await HospitalidadService.getInfoEvento(eventoIdAMIP);
                
                output.innerHTML = `
                    <div class="result-item success">
                        <strong>‚úÖ Info Hospitalidad AMIP</strong>
                        <h3>Evento:</h3>
                        <p>${info.evento.titulo}</p>
                        <h3>Estad√≠sticas:</h3>
                        <pre>${JSON.stringify(info.estadisticas, null, 2)}</pre>
                    </div>
                `;
            } catch (error) {
                output.innerHTML = `
                    <div class="result-item error">
                        <strong>‚ùå Error:</strong> ${error.message}
                    </div>
                `;
            }
        }

        async function testCanPostular() {
            const output = document.getElementById('hospitalidad-output');
            output.innerHTML = '<div class="result-item">‚è≥ Verificando...</div>';
            
            try {
                const user = firebase.auth().currentUser;
                if (!user) throw new Error('Debes iniciar sesi√≥n');
                
                const visitante = await HospitalidadService.canPostular(user.uid, eventoIdAMIP, 'visitante');
                const anfitrion = await HospitalidadService.canPostular(user.uid, eventoIdAMIP, 'anfitrion');
                
                output.innerHTML = `
                    <div class="result-item success">
                        <strong>‚úÖ Verificaci√≥n de Permisos</strong>
                        <h3>Como Visitante:</h3>
                        <pre>${JSON.stringify(visitante, null, 2)}</pre>
                        <h3>Como Anfitri√≥n:</h3>
                        <pre>${JSON.stringify(anfitrion, null, 2)}</pre>
                    </div>
                `;
            } catch (error) {
                output.innerHTML = `
                    <div class="result-item error">
                        <strong>‚ùå Error:</strong> ${error.message}
                    </div>
                `;
            }
        }

        async function testGetDashboard() {
            const output = document.getElementById('hospitalidad-output');
            output.innerHTML = '<div class="result-item">‚è≥ Cargando dashboard...</div>';
            
            try {
                const user = firebase.auth().currentUser;
                if (!user) throw new Error('Debes iniciar sesi√≥n');
                
                const dashboard = await HospitalidadService.getDashboardUsuario(user.uid);
                
                output.innerHTML = `
                    <div class="result-item success">
                        <strong>‚úÖ Dashboard Usuario</strong>
                        <pre>${JSON.stringify(dashboard, null, 2)}</pre>
                    </div>
                `;
            } catch (error) {
                output.innerHTML = `
                    <div class="result-item error">
                        <strong>‚ùå Error:</strong> ${error.message}
                    </div>
                `;
            }
        }

        // ============================================
        // MATCHING SERVICE
        // ============================================
        async function testGetSugerencias() {
            const output = document.getElementById('matching-output');
            output.innerHTML = '<div class="result-item">‚è≥ Generando sugerencias...</div>';
            
            try {
                const sugerencias = await MatchingService.getSugerenciasEvento(eventoIdAMIP);
                
                if (sugerencias.length === 0) {
                    output.innerHTML = `
                        <div class="result-item">
                            <strong>‚ÑπÔ∏è No hay suficientes postulaciones para generar sugerencias</strong>
                            <p>Necesitas al menos 1 visitante y 1 anfitri√≥n aprobados.</p>
                        </div>
                    `;
                } else {
                    let html = `<div class="result-item success"><strong>‚úÖ Sugerencias: ${sugerencias.length}</strong></div>`;
                    html += '<div class="grid">';
                    
                    sugerencias.forEach(s => {
                        const scoreInfo = MatchingService.getScoreLabel(s.score);
                        html += `
                            <div class="card">
                                <h3>${scoreInfo.emoji} Score: ${s.score} - ${scoreInfo.label}</h3>
                                <p><strong>Visitante:</strong> ${s.visitante.numPersonas} personas</p>
                                <p><strong>Anfitri√≥n:</strong> Capacidad ${s.anfitrion.capacidad}</p>
                                <p><strong>Pros:</strong> ${s.detalles.pros.length}</p>
                                <p><strong>Contras:</strong> ${s.detalles.contras.length}</p>
                            </div>
                        `;
                    });
                    
                    html += '</div>';
                    output.innerHTML = html;
                }
            } catch (error) {
                output.innerHTML = `
                    <div class="result-item error">
                        <strong>‚ùå Error:</strong> ${error.message}
                    </div>
                `;
            }
        }

        function testCalcularScore() {
            alert('üéØ C√°lculo de Score\n\nEsta funci√≥n se usa internamente.\nPrueba "Ver Sugerencias Matching" para ver el algoritmo en acci√≥n.');
        }

        // ============================================
        // TEST COMPLETO
        // ============================================
        async function runAllTests() {
            if (!confirm('Esto ejecutar√° todos los tests. ¬øContinuar?')) return;
            
            status.textContent = '‚è≥ Ejecutando todos los tests...';
            status.className = 'status loading';
            
            try {
                await checkAuthStatus();
                await new Promise(r => setTimeout(r, 500));
                
                await testFirestoreRead();
                await new Promise(r => setTimeout(r, 500));
                
                await testGetAllUsuarios();
                await new Promise(r => setTimeout(r, 500));
                
                await testGetPostulacionesEvento();
                await new Promise(r => setTimeout(r, 500));
                
                await testGetInfoEvento();
                await new Promise(r => setTimeout(r, 500));
                
                await testGetSugerencias();
                
                status.textContent = '‚úÖ Todos los tests completados';
                status.className = 'status success';
            } catch (error) {
                status.textContent = '‚ùå Error en los tests: ' + error.message;
                status.className = 'status error';




<function_calls>
<invoke name="artifacts">
<parameter name="command">update</parameter>
<parameter name="id">test_bloque4</parameter>
<parameter name="old_str">                status.textContent = '‚ùå Error en los tests: ' + error.message;
status.className = 'status error';</parameter>
<parameter name="new_str">                status.textContent = '‚ùå Error en los tests: ' + error.message;
status.className = 'status error';
}
}
    function clearAll() {
        document.querySelectorAll('.output').forEach(el => {
            el.innerHTML = '';
        });
        status.textContent = '‚è≥ Esperando tests...';
        status.className = 'status loading';
    }
</script>
</body>
</html></parameter>
